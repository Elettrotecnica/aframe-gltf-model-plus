{"version":3,"file":"gltf-model-plus.min.js","mappings":"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","sources":["webpack://@c-frame/aframe-gltf-model-plus/webpack/universalModuleDefinition","webpack://@c-frame/aframe-gltf-model-plus/./src/components/reflection-probe.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/uv-scroll.js","webpack://@c-frame/aframe-gltf-model-plus/external umd \"THREE\"","webpack://@c-frame/aframe-gltf-model-plus/webpack/bootstrap","webpack://@c-frame/aframe-gltf-model-plus/webpack/runtime/make namespace object","webpack://@c-frame/aframe-gltf-model-plus/webpack/runtime/publicPath","webpack://@c-frame/aframe-gltf-model-plus/./node_modules/three/examples/jsm/loaders/RGBELoader.js","webpack://@c-frame/aframe-gltf-model-plus/./node_modules/three/examples/jsm/loaders/LUTCubeLoader.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/environment-settings.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/EventDispatcher.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/FakeEntity.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/utils.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/index.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/media-frame.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/nav-mesh.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/reflection-probe.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/uv-scroll.js","webpack://@c-frame/aframe-gltf-model-plus/./src/inflators/waypoint.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/environment-settings.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/gltf-model-plus.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/media-frame.js","webpack://@c-frame/aframe-gltf-model-plus/./node_modules/three/examples/jsm/math/SimplexNoise.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/simple-water.js","webpack://@c-frame/aframe-gltf-model-plus/./src/components/waypoint.js","webpack://@c-frame/aframe-gltf-model-plus/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"THREE\")) : factory(root[\"THREE\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(self, (__WEBPACK_EXTERNAL_MODULE__612__) => {\nreturn ","AFRAME.registerComponent(\"reflection-probe\", {\n  schema: {\n    size: { default: 1 },\n    envMapTexture: { type: \"map\" },\n  },\n\n  init: function () {\n    this.el.object3D.updateWorldMatrix(true, false);\n\n    const box = new THREE.Box3()\n      .setFromCenterAndSize(new THREE.Vector3(), new THREE.Vector3().setScalar(this.data.size * 2))\n      .applyMatrix4(this.el.object3D.matrixWorld);\n\n    this.el.setObject3D(\"probe\", new THREE.ReflectionProbe(box, this.data.envMapTexture));\n\n    // if (this.el.sceneEl.systems[\"hubs-systems\"].environmentSystem.debugMode) {\n    //   const debugBox = new THREE.Box3().setFromCenterAndSize(\n    //     new THREE.Vector3(),\n    //     new THREE.Vector3().setScalar(this.data.size * 2)\n    //   );\n    //   this.el.setObject3D(\n    //     \"helper\",\n    //     new THREE.Box3Helper(debugBox, new THREE.Color(Math.random(), Math.random(), Math.random()))\n    //   );\n    // }\n  },\n});\n","/* global AFRAME, THREE */\n// This is a modified copy of\n// https://github.com/mozilla/hubs/blob/6c49ce303ad7e030c80b301dbc3ce100cac7d9c1/src/components/uv-scroll.js\n// to work with an aframe system and waiting for material to be loaded via the materialtextureloaded event.\n// @license MPL 2.0 https://github.com/mozilla/hubs/blob/master/LICENSE\n\nconst textureToData = new Map();\nconst registeredTextures = [];\n\nAFRAME.registerSystem(\"uv-scroll\", {\n  tick(t, dt) {\n    for (let i = 0; i < registeredTextures.length; i++) {\n      const map = registeredTextures[i];\n      const { offset, instances } = textureToData.get(map);\n      const { component } = instances[0];\n\n      offset.addScaledVector(component.data.speed, dt / 1000);\n\n      offset.x = offset.x % 1.0;\n      offset.y = offset.y % 1.0;\n\n      const increment = component.data.increment;\n      map.offset.x = increment.x ? offset.x - (offset.x % increment.x) : offset.x;\n      map.offset.y = increment.y ? offset.y - (offset.y % increment.y) : offset.y;\n    }\n  },\n});\n\n/**\n * Animate the UV offset of a mesh's material\n * @component uv-scroll\n */\nAFRAME.registerComponent(\"uv-scroll\", {\n  schema: {\n    speed: { type: \"vec2\", default: { x: 0, y: 0 } },\n    increment: { type: \"vec2\", default: { x: 0, y: 0 } },\n  },\n  play() {\n    const mesh = this.el.getObject3D(\"mesh\") || this.el.getObject3D(\"skinnedmesh\");\n    const material = mesh && mesh.material;\n    if (material) {\n      // We store mesh here instead of the material directly because we end up swapping out the material in injectCustomShaderChunks.\n      // We need material in the first place because of MobileStandardMaterial\n      const instance = { component: this, mesh };\n\n      this.instance = instance;\n      this.map = material.map || material.emissiveMap;\n\n      if (this.map && !textureToData.has(this.map)) {\n        textureToData.set(this.map, {\n          offset: new THREE.Vector2(),\n          instances: [instance],\n        });\n        registeredTextures.push(this.map);\n      } else if (!this.map) {\n        if (this.el.components.material) {\n          // when using material and uv-scroll components\n          this.el.addEventListener(\"materialtextureloaded\", () => {\n            this.map = material.map || material.emissiveMap;\n            if (!textureToData.has(this.map)) {\n              textureToData.set(this.map, {\n                offset: new THREE.Vector2(),\n                instances: [instance],\n              });\n              registeredTextures.push(this.map);\n            }\n          });\n        } else {\n          console.warn(\"Ignoring uv-scroll added to mesh with no scrollable texture.\");\n        }\n      } else {\n        console.warn(\n          \"Multiple uv-scroll instances added to objects sharing a texture, only the speed/increment from the first one will have any effect\"\n        );\n        textureToData.get(this.map).instances.push(instance);\n      }\n    }\n  },\n\n  pause() {\n    if (this.map) {\n      const instances = textureToData.get(this.map).instances;\n      instances.splice(instances.indexOf(this.instance), 1);\n      // If this was the last uv-scroll component for a given texture\n      if (!instances.length) {\n        textureToData.delete(this.map);\n        registeredTextures.splice(registeredTextures.indexOf(this.map), 1);\n      }\n    }\n  },\n});\n","module.exports = __WEBPACK_EXTERNAL_MODULE__612__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"\";","import {\n\tDataTextureLoader,\n\tDataUtils,\n\tFloatType,\n\tHalfFloatType,\n\tLinearFilter,\n\tLinearSRGBColorSpace\n} from 'three';\n\n// https://github.com/mrdoob/three.js/issues/5552\n// http://en.wikipedia.org/wiki/RGBE_image_format\n\nclass RGBELoader extends DataTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.type = HalfFloatType;\n\n\t}\n\n\t// adapted from http://www.graphics.cornell.edu/~bjw/rgbe.html\n\n\tparse( buffer ) {\n\n\t\tconst\n\t\t\t/* default error routine.  change this to change error handling */\n\t\t\trgbe_read_error = 1,\n\t\t\trgbe_write_error = 2,\n\t\t\trgbe_format_error = 3,\n\t\t\trgbe_memory_error = 4,\n\t\t\trgbe_error = function ( rgbe_error_code, msg ) {\n\n\t\t\t\tswitch ( rgbe_error_code ) {\n\n\t\t\t\t\tcase rgbe_read_error: throw new Error( 'THREE.RGBELoader: Read Error: ' + ( msg || '' ) );\n\t\t\t\t\tcase rgbe_write_error: throw new Error( 'THREE.RGBELoader: Write Error: ' + ( msg || '' ) );\n\t\t\t\t\tcase rgbe_format_error: throw new Error( 'THREE.RGBELoader: Bad File Format: ' + ( msg || '' ) );\n\t\t\t\t\tdefault:\n\t\t\t\t\tcase rgbe_memory_error: throw new Error( 'THREE.RGBELoader: Memory Error: ' + ( msg || '' ) );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\t/* offsets to red, green, and blue components in a data (float) pixel */\n\t\t\t//RGBE_DATA_RED = 0,\n\t\t\t//RGBE_DATA_GREEN = 1,\n\t\t\t//RGBE_DATA_BLUE = 2,\n\n\t\t\t/* number of floats per pixel, use 4 since stored in rgba image format */\n\t\t\t//RGBE_DATA_SIZE = 4,\n\n\t\t\t/* flags indicating which fields in an rgbe_header_info are valid */\n\t\t\tRGBE_VALID_PROGRAMTYPE = 1,\n\t\t\tRGBE_VALID_FORMAT = 2,\n\t\t\tRGBE_VALID_DIMENSIONS = 4,\n\n\t\t\tNEWLINE = '\\n',\n\n\t\t\tfgets = function ( buffer, lineLimit, consume ) {\n\n\t\t\t\tconst chunkSize = 128;\n\n\t\t\t\tlineLimit = ! lineLimit ? 1024 : lineLimit;\n\t\t\t\tlet p = buffer.pos,\n\t\t\t\t\ti = - 1, len = 0, s = '',\n\t\t\t\t\tchunk = String.fromCharCode.apply( null, new Uint16Array( buffer.subarray( p, p + chunkSize ) ) );\n\n\t\t\t\twhile ( ( 0 > ( i = chunk.indexOf( NEWLINE ) ) ) && ( len < lineLimit ) && ( p < buffer.byteLength ) ) {\n\n\t\t\t\t\ts += chunk; len += chunk.length;\n\t\t\t\t\tp += chunkSize;\n\t\t\t\t\tchunk += String.fromCharCode.apply( null, new Uint16Array( buffer.subarray( p, p + chunkSize ) ) );\n\n\t\t\t\t}\n\n\t\t\t\tif ( - 1 < i ) {\n\n\t\t\t\t\t/*for (i=l-1; i>=0; i--) {\n\t\t\t\t\t\tbyteCode = m.charCodeAt(i);\n\t\t\t\t\t\tif (byteCode > 0x7f && byteCode <= 0x7ff) byteLen++;\n\t\t\t\t\t\telse if (byteCode > 0x7ff && byteCode <= 0xffff) byteLen += 2;\n\t\t\t\t\t\tif (byteCode >= 0xDC00 && byteCode <= 0xDFFF) i--; //trail surrogate\n\t\t\t\t\t}*/\n\t\t\t\t\tif ( false !== consume ) buffer.pos += len + i + 1;\n\t\t\t\t\treturn s + chunk.slice( 0, i );\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t},\n\n\t\t\t/* minimal header reading.  modify if you want to parse more information */\n\t\t\tRGBE_ReadHeader = function ( buffer ) {\n\n\n\t\t\t\t// regexes to parse header info fields\n\t\t\t\tconst magic_token_re = /^#\\?(\\S+)/,\n\t\t\t\t\tgamma_re = /^\\s*GAMMA\\s*=\\s*(\\d+(\\.\\d+)?)\\s*$/,\n\t\t\t\t\texposure_re = /^\\s*EXPOSURE\\s*=\\s*(\\d+(\\.\\d+)?)\\s*$/,\n\t\t\t\t\tformat_re = /^\\s*FORMAT=(\\S+)\\s*$/,\n\t\t\t\t\tdimensions_re = /^\\s*\\-Y\\s+(\\d+)\\s+\\+X\\s+(\\d+)\\s*$/,\n\n\t\t\t\t\t// RGBE format header struct\n\t\t\t\t\theader = {\n\n\t\t\t\t\t\tvalid: 0, /* indicate which fields are valid */\n\n\t\t\t\t\t\tstring: '', /* the actual header string */\n\n\t\t\t\t\t\tcomments: '', /* comments found in header */\n\n\t\t\t\t\t\tprogramtype: 'RGBE', /* listed at beginning of file to identify it after \"#?\". defaults to \"RGBE\" */\n\n\t\t\t\t\t\tformat: '', /* RGBE format, default 32-bit_rle_rgbe */\n\n\t\t\t\t\t\tgamma: 1.0, /* image has already been gamma corrected with given gamma. defaults to 1.0 (no correction) */\n\n\t\t\t\t\t\texposure: 1.0, /* a value of 1.0 in an image corresponds to <exposure> watts/steradian/m^2. defaults to 1.0 */\n\n\t\t\t\t\t\twidth: 0, height: 0 /* image dimensions, width/height */\n\n\t\t\t\t\t};\n\n\t\t\t\tlet line, match;\n\n\t\t\t\tif ( buffer.pos >= buffer.byteLength || ! ( line = fgets( buffer ) ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_read_error, 'no header found' );\n\n\t\t\t\t}\n\n\t\t\t\t/* if you want to require the magic token then uncomment the next line */\n\t\t\t\tif ( ! ( match = line.match( magic_token_re ) ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'bad initial token' );\n\n\t\t\t\t}\n\n\t\t\t\theader.valid |= RGBE_VALID_PROGRAMTYPE;\n\t\t\t\theader.programtype = match[ 1 ];\n\t\t\t\theader.string += line + '\\n';\n\n\t\t\t\twhile ( true ) {\n\n\t\t\t\t\tline = fgets( buffer );\n\t\t\t\t\tif ( false === line ) break;\n\t\t\t\t\theader.string += line + '\\n';\n\n\t\t\t\t\tif ( '#' === line.charAt( 0 ) ) {\n\n\t\t\t\t\t\theader.comments += line + '\\n';\n\t\t\t\t\t\tcontinue; // comment line\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( gamma_re ) ) {\n\n\t\t\t\t\t\theader.gamma = parseFloat( match[ 1 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( exposure_re ) ) {\n\n\t\t\t\t\t\theader.exposure = parseFloat( match[ 1 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( format_re ) ) {\n\n\t\t\t\t\t\theader.valid |= RGBE_VALID_FORMAT;\n\t\t\t\t\t\theader.format = match[ 1 ];//'32-bit_rle_rgbe';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( dimensions_re ) ) {\n\n\t\t\t\t\t\theader.valid |= RGBE_VALID_DIMENSIONS;\n\t\t\t\t\t\theader.height = parseInt( match[ 1 ], 10 );\n\t\t\t\t\t\theader.width = parseInt( match[ 2 ], 10 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ( header.valid & RGBE_VALID_FORMAT ) && ( header.valid & RGBE_VALID_DIMENSIONS ) ) break;\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! ( header.valid & RGBE_VALID_FORMAT ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'missing format specifier' );\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! ( header.valid & RGBE_VALID_DIMENSIONS ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'missing image size specifier' );\n\n\t\t\t\t}\n\n\t\t\t\treturn header;\n\n\t\t\t},\n\n\t\t\tRGBE_ReadPixels_RLE = function ( buffer, w, h ) {\n\n\t\t\t\tconst scanline_width = w;\n\n\t\t\t\tif (\n\t\t\t\t\t// run length encoding is not allowed so read flat\n\t\t\t\t\t( ( scanline_width < 8 ) || ( scanline_width > 0x7fff ) ) ||\n\t\t\t\t\t// this file is not run length encoded\n\t\t\t\t\t( ( 2 !== buffer[ 0 ] ) || ( 2 !== buffer[ 1 ] ) || ( buffer[ 2 ] & 0x80 ) )\n\t\t\t\t) {\n\n\t\t\t\t\t// return the flat buffer\n\t\t\t\t\treturn new Uint8Array( buffer );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scanline_width !== ( ( buffer[ 2 ] << 8 ) | buffer[ 3 ] ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'wrong scanline width' );\n\n\t\t\t\t}\n\n\t\t\t\tconst data_rgba = new Uint8Array( 4 * w * h );\n\n\t\t\t\tif ( ! data_rgba.length ) {\n\n\t\t\t\t\trgbe_error( rgbe_memory_error, 'unable to allocate buffer space' );\n\n\t\t\t\t}\n\n\t\t\t\tlet offset = 0, pos = 0;\n\n\t\t\t\tconst ptr_end = 4 * scanline_width;\n\t\t\t\tconst rgbeStart = new Uint8Array( 4 );\n\t\t\t\tconst scanline_buffer = new Uint8Array( ptr_end );\n\t\t\t\tlet num_scanlines = h;\n\n\t\t\t\t// read in each successive scanline\n\t\t\t\twhile ( ( num_scanlines > 0 ) && ( pos < buffer.byteLength ) ) {\n\n\t\t\t\t\tif ( pos + 4 > buffer.byteLength ) {\n\n\t\t\t\t\t\trgbe_error( rgbe_read_error );\n\n\t\t\t\t\t}\n\n\t\t\t\t\trgbeStart[ 0 ] = buffer[ pos ++ ];\n\t\t\t\t\trgbeStart[ 1 ] = buffer[ pos ++ ];\n\t\t\t\t\trgbeStart[ 2 ] = buffer[ pos ++ ];\n\t\t\t\t\trgbeStart[ 3 ] = buffer[ pos ++ ];\n\n\t\t\t\t\tif ( ( 2 != rgbeStart[ 0 ] ) || ( 2 != rgbeStart[ 1 ] ) || ( ( ( rgbeStart[ 2 ] << 8 ) | rgbeStart[ 3 ] ) != scanline_width ) ) {\n\n\t\t\t\t\t\trgbe_error( rgbe_format_error, 'bad rgbe scanline format' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// read each of the four channels for the scanline into the buffer\n\t\t\t\t\t// first red, then green, then blue, then exponent\n\t\t\t\t\tlet ptr = 0, count;\n\n\t\t\t\t\twhile ( ( ptr < ptr_end ) && ( pos < buffer.byteLength ) ) {\n\n\t\t\t\t\t\tcount = buffer[ pos ++ ];\n\t\t\t\t\t\tconst isEncodedRun = count > 128;\n\t\t\t\t\t\tif ( isEncodedRun ) count -= 128;\n\n\t\t\t\t\t\tif ( ( 0 === count ) || ( ptr + count > ptr_end ) ) {\n\n\t\t\t\t\t\t\trgbe_error( rgbe_format_error, 'bad scanline data' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( isEncodedRun ) {\n\n\t\t\t\t\t\t\t// a (encoded) run of the same value\n\t\t\t\t\t\t\tconst byteValue = buffer[ pos ++ ];\n\t\t\t\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\t\t\t\tscanline_buffer[ ptr ++ ] = byteValue;\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//ptr += count;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// a literal-run\n\t\t\t\t\t\t\tscanline_buffer.set( buffer.subarray( pos, pos + count ), ptr );\n\t\t\t\t\t\t\tptr += count; pos += count;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// now convert data from buffer into rgba\n\t\t\t\t\t// first red, then green, then blue, then exponent (alpha)\n\t\t\t\t\tconst l = scanline_width; //scanline_buffer.byteLength;\n\t\t\t\t\tfor ( let i = 0; i < l; i ++ ) {\n\n\t\t\t\t\t\tlet off = 0;\n\t\t\t\t\t\tdata_rgba[ offset ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toff += scanline_width; //1;\n\t\t\t\t\t\tdata_rgba[ offset + 1 ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toff += scanline_width; //1;\n\t\t\t\t\t\tdata_rgba[ offset + 2 ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toff += scanline_width; //1;\n\t\t\t\t\t\tdata_rgba[ offset + 3 ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toffset += 4;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tnum_scanlines --;\n\n\t\t\t\t}\n\n\t\t\t\treturn data_rgba;\n\n\t\t\t};\n\n\t\tconst RGBEByteToRGBFloat = function ( sourceArray, sourceOffset, destArray, destOffset ) {\n\n\t\t\tconst e = sourceArray[ sourceOffset + 3 ];\n\t\t\tconst scale = Math.pow( 2.0, e - 128.0 ) / 255.0;\n\n\t\t\tdestArray[ destOffset + 0 ] = sourceArray[ sourceOffset + 0 ] * scale;\n\t\t\tdestArray[ destOffset + 1 ] = sourceArray[ sourceOffset + 1 ] * scale;\n\t\t\tdestArray[ destOffset + 2 ] = sourceArray[ sourceOffset + 2 ] * scale;\n\t\t\tdestArray[ destOffset + 3 ] = 1;\n\n\t\t};\n\n\t\tconst RGBEByteToRGBHalf = function ( sourceArray, sourceOffset, destArray, destOffset ) {\n\n\t\t\tconst e = sourceArray[ sourceOffset + 3 ];\n\t\t\tconst scale = Math.pow( 2.0, e - 128.0 ) / 255.0;\n\n\t\t\t// clamping to 65504, the maximum representable value in float16\n\t\t\tdestArray[ destOffset + 0 ] = DataUtils.toHalfFloat( Math.min( sourceArray[ sourceOffset + 0 ] * scale, 65504 ) );\n\t\t\tdestArray[ destOffset + 1 ] = DataUtils.toHalfFloat( Math.min( sourceArray[ sourceOffset + 1 ] * scale, 65504 ) );\n\t\t\tdestArray[ destOffset + 2 ] = DataUtils.toHalfFloat( Math.min( sourceArray[ sourceOffset + 2 ] * scale, 65504 ) );\n\t\t\tdestArray[ destOffset + 3 ] = DataUtils.toHalfFloat( 1 );\n\n\t\t};\n\n\t\tconst byteArray = new Uint8Array( buffer );\n\t\tbyteArray.pos = 0;\n\t\tconst rgbe_header_info = RGBE_ReadHeader( byteArray );\n\n\t\tconst w = rgbe_header_info.width,\n\t\t\th = rgbe_header_info.height,\n\t\t\timage_rgba_data = RGBE_ReadPixels_RLE( byteArray.subarray( byteArray.pos ), w, h );\n\n\n\t\tlet data, type;\n\t\tlet numElements;\n\n\t\tswitch ( this.type ) {\n\n\t\t\tcase FloatType:\n\n\t\t\t\tnumElements = image_rgba_data.length / 4;\n\t\t\t\tconst floatArray = new Float32Array( numElements * 4 );\n\n\t\t\t\tfor ( let j = 0; j < numElements; j ++ ) {\n\n\t\t\t\t\tRGBEByteToRGBFloat( image_rgba_data, j * 4, floatArray, j * 4 );\n\n\t\t\t\t}\n\n\t\t\t\tdata = floatArray;\n\t\t\t\ttype = FloatType;\n\t\t\t\tbreak;\n\n\t\t\tcase HalfFloatType:\n\n\t\t\t\tnumElements = image_rgba_data.length / 4;\n\t\t\t\tconst halfArray = new Uint16Array( numElements * 4 );\n\n\t\t\t\tfor ( let j = 0; j < numElements; j ++ ) {\n\n\t\t\t\t\tRGBEByteToRGBHalf( image_rgba_data, j * 4, halfArray, j * 4 );\n\n\t\t\t\t}\n\n\t\t\t\tdata = halfArray;\n\t\t\t\ttype = HalfFloatType;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tthrow new Error( 'THREE.RGBELoader: Unsupported type: ' + this.type );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn {\n\t\t\twidth: w, height: h,\n\t\t\tdata: data,\n\t\t\theader: rgbe_header_info.string,\n\t\t\tgamma: rgbe_header_info.gamma,\n\t\t\texposure: rgbe_header_info.exposure,\n\t\t\ttype: type\n\t\t};\n\n\t}\n\n\tsetDataType( value ) {\n\n\t\tthis.type = value;\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tfunction onLoadCallback( texture, texData ) {\n\n\t\t\tswitch ( texture.type ) {\n\n\t\t\t\tcase FloatType:\n\t\t\t\tcase HalfFloatType:\n\n\t\t\t\t\ttexture.colorSpace = LinearSRGBColorSpace;\n\t\t\t\t\ttexture.minFilter = LinearFilter;\n\t\t\t\t\ttexture.magFilter = LinearFilter;\n\t\t\t\t\ttexture.generateMipmaps = false;\n\t\t\t\t\ttexture.flipY = true;\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( onLoad ) onLoad( texture, texData );\n\n\t\t}\n\n\t\treturn super.load( url, onLoadCallback, onProgress, onError );\n\n\t}\n\n}\n\nexport { RGBELoader };\n","// https://wwwimages2.adobe.com/content/dam/acom/en/products/speedgrade/cc/pdfs/cube-lut-specification-1.0.pdf\n\nimport {\n\tClampToEdgeWrapping,\n\tDataTexture,\n\tData3DTexture,\n\tFileLoader,\n\tFloatType,\n\tLinearFilter,\n\tLoader,\n\tUnsignedByteType,\n\tVector3,\n} from 'three';\n\nexport class LUTCubeLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.type = UnsignedByteType;\n\n\t}\n\n\tsetType( type ) {\n\n\t\tif ( type !== UnsignedByteType && type !== FloatType ) {\n\n\t\t\tthrow new Error( 'LUTCubeLoader: Unsupported type' );\n\n\t\t}\n\n\t\tthis.type = type;\n\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'text' );\n\t\tloader.load( url, text => {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( this.parse( text ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tthis.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( input ) {\n\n\t\tconst regExpTitle = /TITLE +\"([^\"]*)\"/;\n\t\tconst regExpSize = /LUT_3D_SIZE +(\\d+)/;\n\t\tconst regExpDomainMin = /DOMAIN_MIN +([\\d.]+) +([\\d.]+) +([\\d.]+)/;\n\t\tconst regExpDomainMax = /DOMAIN_MAX +([\\d.]+) +([\\d.]+) +([\\d.]+)/;\n\t\tconst regExpDataPoints = /^([\\d.e+-]+) +([\\d.e+-]+) +([\\d.e+-]+) *$/gm;\n\n\t\tlet result = regExpTitle.exec( input );\n\t\tconst title = ( result !== null ) ? result[ 1 ] : null;\n\n\t\tresult = regExpSize.exec( input );\n\n\t\tif ( result === null ) {\n\n\t\t\tthrow new Error( 'LUTCubeLoader: Missing LUT_3D_SIZE information' );\n\n\t\t}\n\n\t\tconst size = Number( result[ 1 ] );\n\t\tconst length = size ** 3 * 4;\n\t\tconst data = this.type === UnsignedByteType ? new Uint8Array( length ) : new Float32Array( length );\n\n\t\tconst domainMin = new Vector3( 0, 0, 0 );\n\t\tconst domainMax = new Vector3( 1, 1, 1 );\n\n\t\tresult = regExpDomainMin.exec( input );\n\n\t\tif ( result !== null ) {\n\n\t\t\tdomainMin.set( Number( result[ 1 ] ), Number( result[ 2 ] ), Number( result[ 3 ] ) );\n\n\t\t}\n\n\t\tresult = regExpDomainMax.exec( input );\n\n\t\tif ( result !== null ) {\n\n\t\t\tdomainMax.set( Number( result[ 1 ] ), Number( result[ 2 ] ), Number( result[ 3 ] ) );\n\n\t\t}\n\n\t\tif ( domainMin.x > domainMax.x || domainMin.y > domainMax.y || domainMin.z > domainMax.z ) {\n\n\t\t\tthrow new Error( 'LUTCubeLoader: Invalid input domain' );\n\n\t\t}\n\n\t\tconst scale = this.type === UnsignedByteType ? 255 : 1;\n\t\tlet i = 0;\n\n\t\twhile ( ( result = regExpDataPoints.exec( input ) ) !== null ) {\n\n\t\t\tdata[ i ++ ] = Number( result[ 1 ] ) * scale;\n\t\t\tdata[ i ++ ] = Number( result[ 2 ] ) * scale;\n\t\t\tdata[ i ++ ] = Number( result[ 3 ] ) * scale;\n\t\t\tdata[ i ++ ] = scale;\n\n\t\t}\n\n\t\tconst texture = new DataTexture();\n\t\ttexture.image.data = data;\n\t\ttexture.image.width = size;\n\t\ttexture.image.height = size * size;\n\t\ttexture.type = this.type;\n\t\ttexture.magFilter = LinearFilter;\n\t\ttexture.minFilter = LinearFilter;\n\t\ttexture.wrapS = ClampToEdgeWrapping;\n\t\ttexture.wrapT = ClampToEdgeWrapping;\n\t\ttexture.generateMipmaps = false;\n\t\ttexture.needsUpdate = true;\n\n\t\tconst texture3D = new Data3DTexture();\n\t\ttexture3D.image.data = data;\n\t\ttexture3D.image.width = size;\n\t\ttexture3D.image.height = size;\n\t\ttexture3D.image.depth = size;\n\t\ttexture3D.type = this.type;\n\t\ttexture3D.magFilter = LinearFilter;\n\t\ttexture3D.minFilter = LinearFilter;\n\t\ttexture3D.wrapS = ClampToEdgeWrapping;\n\t\ttexture3D.wrapT = ClampToEdgeWrapping;\n\t\ttexture3D.wrapR = ClampToEdgeWrapping;\n\t\ttexture3D.generateMipmaps = false;\n\t\ttexture3D.needsUpdate = true;\n\n\t\treturn {\n\t\t\ttitle,\n\t\t\tsize,\n\t\t\tdomainMin,\n\t\t\tdomainMax,\n\t\t\ttexture,\n\t\t\ttexture3D,\n\t\t};\n\n\t}\n\n}\n","/* global THREE */\nimport { LUTCubeLoader } from \"three/addons/loaders/LUTCubeLoader.js\";\nimport blenderLutPath from \"../assets/blender-lut.cube\";\n\nexport const defaultEnvironmentSettings = {\n  toneMapping: \"LUTToneMapping\",\n  toneMappingExposure: 1,\n  backgroundColor: \"skyblue\",\n  backgroundTexture: null,\n  envMapTexture: null,\n};\n\n// const toneMappingOptions = {\n//   None: \"NoToneMapping\",\n//   Linear: \"LinearToneMapping\",\n//   Reinhard: \"ReinhardToneMapping\",\n//   Cineon: \"CineonToneMapping\",\n//   ACESFilmic: \"ACESFilmicToneMapping\",\n//   CustomToneMapping: \"CustomToneMapping\",\n//   LUTToneMapping: \"LUTToneMapping\",\n// };\n\nlet blenderLUTPromise; // lazy loaded\n\nconst updateMaterials = (scene) => {\n  scene.traverse((o) => {\n    if (o.material) o.material.needsUpdate = true;\n  });\n};\n\n// settings example without GLTFHubsComponentsExtension plugin:\n// {\n//   \"toneMapping\": \"LUTToneMapping\",\n//   \"toneMappingExposure\": 1,\n//   \"backgroundColor\": \"#ffffff\",\n//   \"backgroundTexture\": {\n//       \"__mhc_link_type\": \"texture\",\n//       \"index\": 0\n//   },\n//   \"envMapTexture\": {\n//       \"__mhc_link_type\": \"texture\",\n//       \"index\": 1\n//   }\n// }\n// With GLTFHubsComponentsExtension plugin, backgroundTexture and envMapTexture are Texture objects.\nexport function inflateEnvironmentSettings(sceneEl, settings) {\n  const scene = sceneEl.object3D;\n  const renderer = sceneEl.renderer;\n  let materialsNeedUpdate = false;\n  const newToneMapping = THREE[settings.toneMapping];\n  if (typeof newToneMapping === \"undefined\") {\n    console.error(\"You need an aframe build with the tonemappingLUT patch to make LUTToneMapping work.\");\n    return;\n  }\n  if (renderer.toneMapping !== newToneMapping) {\n    renderer.toneMapping = newToneMapping;\n    if (newToneMapping === THREE.LUTToneMapping) {\n      if (!blenderLUTPromise) {\n        blenderLUTPromise = new Promise(function (resolve, reject) {\n          new LUTCubeLoader().load(blenderLutPath, ({ texture3D }) => resolve(texture3D), null, reject);\n        });\n      }\n\n      blenderLUTPromise\n        .then((t) => {\n          renderer.tonemappingLUT = t;\n          updateMaterials(scene);\n        })\n        .catch(function (e) {\n          console.error(\"Error loading Blender LUT\", e);\n          blenderLUTPromise = null;\n        });\n    } else {\n      renderer.tonemappingLUT = null;\n      materialsNeedUpdate = true;\n    }\n  }\n\n  renderer.toneMappingExposure = settings.toneMappingExposure;\n\n  if (settings.backgroundTexture) {\n    // Assume texture is always an equirect for now\n    settings.backgroundTexture.mapping = THREE.EquirectangularReflectionMapping;\n    settings.backgroundTexture.flipY = true;\n    scene.background = settings.backgroundTexture;\n  } else {\n    scene.background = new THREE.Color(settings.backgroundColor);\n  }\n  if (settings.envMapTexture) {\n    // if (this.prevEnvMapTextureUUID !== settings.envMapTexture.uuid) {\n    // this.prevEnvMapTextureUUID = settings.envMapTexture.uuid;\n    // TODO PMREMGenerator should be fixed to not assume this\n    settings.envMapTexture.flipY = true;\n    // Assume texture is always an equirect for now\n    settings.envMapTexture.mapping = THREE.EquirectangularReflectionMapping;\n    scene.environment = settings.envMapTexture;\n    // }\n    // } else if (settings.skybox) {\n    //   if (this.prevEnvMapTextureUUID !== settings.skybox.uuid) {\n    //     this.prevEnvMapTextureUUID = settings.skybox.uuid;\n    //     this.scene.environment = settings.skybox.sky.generateEnvironmentMap(this.renderer);\n    //   }\n  } else {\n    scene.environment = null;\n    // this.prevEnvMapTextureUUID = null;\n  }\n\n  if (materialsNeedUpdate) {\n    updateMaterials(scene);\n  }\n}\n","/**\n * @author mrdoob / http://mrdoob.com/\n * @license MIT\n * https://github.com/mrdoob/eventdispatcher.js/tree/f31179e964ce6cd76818fd25f4152d4bcc82040c/src\n * with `event.target = this` commented, target is set before calling dispatchEvent.\n * This code is used in FakeEntity.\n */\n\nclass EventDispatcher {\n  addEventListener(type, listener) {\n    if (this._listeners === undefined) this._listeners = {};\n\n    const listeners = this._listeners;\n\n    if (listeners[type] === undefined) {\n      listeners[type] = [];\n    }\n\n    if (listeners[type].indexOf(listener) === -1) {\n      listeners[type].push(listener);\n    }\n  }\n\n  hasEventListener(type, listener) {\n    if (this._listeners === undefined) return false;\n\n    const listeners = this._listeners;\n\n    return listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1;\n  }\n\n  removeEventListener(type, listener) {\n    if (this._listeners === undefined) return;\n\n    const listeners = this._listeners;\n    const listenerArray = listeners[type];\n\n    if (listenerArray !== undefined) {\n      const index = listenerArray.indexOf(listener);\n\n      if (index !== -1) {\n        listenerArray.splice(index, 1);\n      }\n    }\n  }\n\n  dispatchEvent(event) {\n    if (this._listeners === undefined) return;\n\n    const listeners = this._listeners;\n    const listenerArray = listeners[event.type];\n\n    if (listenerArray !== undefined) {\n      // event.target = this;\n\n      // Make a copy, in case listeners are removed while iterating.\n      const array = listenerArray.slice(0);\n\n      for (let i = 0, l = array.length; i < l; i++) {\n        array[i].call(this, event);\n      }\n    }\n  }\n}\n\nexport { EventDispatcher };\n","/* global AFRAME, NAF, THREE */\nimport { EventDispatcher } from \"./EventDispatcher\";\n\nconst MULTIPLE_COMPONENT_DELIMITER = \"__\";\n\n// Reusable object for performance\nconst eventData = {};\nconst singlePropUpdate = {};\nconst FAKE_NODE = { removeChild: () => {} }; // eslint-disable-line\n\nfunction getRotation(entityEl) {\n  const radToDeg = THREE.MathUtils.radToDeg;\n  const rotation = entityEl.object3D.rotation;\n  const rotationObj = entityEl.rotationObj;\n  rotationObj.x = radToDeg(rotation.x);\n  rotationObj.y = radToDeg(rotation.y);\n  rotationObj.z = radToDeg(rotation.z);\n  return rotationObj;\n}\n\n/**\n * FakeEntity has a similar API than a-entity but doesn't extend HTMLElement.\n * It allows to use existing aframe components on a THREE node (Group or Object3D) without adding extra DOM element or THREE.Group.\n * This object is created automatically via the addComponent function used in gltf-model-plus component.\n * Differences from a-entity:\n * - Doesn't support component dependencies or mixins logic\n * - Support only simple setAttribute(componentName, object), only one component of the same type, mainly used if a component is using this api.\n * - getAttribute/removeAttribute is not supported, so we're not handling special case of getAttribute for position rotation scale,\n *   use object3D.position directly.\n * - el.object3D is the node.\n *   The fake entity is there only to have a compatible API to use some existing aframe components.\n * - Be careful, node.el may not be the FakeEntity until the FakeEntity is created by adding a first component to the node,\n *   before that it will be the closest a-entity node, you may use node.fakeEl if you need to access the fake entity.\n * - In a component associated to a FakeEntity, this.el.children and this.el.parentNode won't be supported. The THREE node is the primary element here,\n *   so you probably want to modify the component to use this.el.object3D.children for example.\n * - FakeEntity remove is not implemented because we don't have children/parentNode set. (We actually have a weird hack for parentNode, see below.)\n *   Properly removing all components are done externarly by calling node.fakeEl.destroy() in gltf-model-plus remove function.\n * - Because FakeEntity is not a DOM element, you can't use this.el.querySelector API.\n * - You can't use document.querySelectorAll('[waypoint]')) to find all waypoint component set on a FakeEntity either.\n *\n * This implementation has been tested with the following components: gltf-model uv-scroll reflection-probe waypoint/networked\n * but we currently don't use it for waypoint/networked because of compatibility with raycaster and querySelector\n */\nexport class FakeEntity extends EventDispatcher {\n  constructor(node) {\n    super();\n    this.components = {};\n    // To avoid double initializations and infinite loops.\n    this.initializingComponents = {};\n    this.object3D = node;\n    this.sceneEl = node.el.sceneEl; // node.el at this point is a a-entity where we loaded the glb\n    this.object3D.el = this; // override node.el with this FakeEntity instance\n    this.isEntity = true; // used for raycaster refreshObjects\n    this.isPlaying = true; // true by default, we don't implement the play/pause logic on this FakeEntity implementation\n    this.object3DMap = {};\n    this.rotationObj = {};\n    this.states = [];\n    // networked component needs parentElement and getAttribute('networked') to set\n    // syncData.parent = this.getParentId();\n    // we don't really support networked parent here, so setting them to sceneEl\n    this.parentElement = this.sceneEl;\n    // networked and networked-audio-source components verify if the entity wasn't removed by checking this.el.parentNode\n    // NAF also have this code\n    // entity.parentNode.removeChild(entity)\n    // that is executed via NAF.connection.disconnect() that calls this.entities.removeRemoteEntities()\n    // so setting a dummy object with removeChild to make them happy.\n    this.parentNode = FAKE_NODE;\n\n    // variables defined by a-node api that are used by the component api\n    this.hasLoaded = true;\n    this.mixinEls = [];\n    this.tagName = \"FAKE_ENTITY\";\n    this.isFakeEntity = true;\n  }\n\n  get children() {\n    throw Error(\"FakeEntity el.children not implemented, try another way, maybe el.object3D.children\");\n  }\n\n  // get parentNode() {\n  //   throw Error(\"FakeEntity el.parentNode not implemented, try another way, maybe el.object3D.parent\");\n  // }\n\n  addState(state) {\n    if (this.is(state)) {\n      return;\n    }\n    this.states.push(state);\n    this.emit(\"stateadded\", state);\n  }\n\n  removeState(state) {\n    const stateIndex = this.states.indexOf(state);\n    if (stateIndex === -1) {\n      return;\n    }\n    this.states.splice(stateIndex, 1);\n    this.emit(\"stateremoved\", state);\n  }\n\n  /**\n   * Checks if the element is in a given state. e.g. el.is('alive');\n   * @type {string} state - Name of the state we want to check\n   */\n  is(state) {\n    return this.states.indexOf(state) !== -1;\n  }\n\n  getAttribute(attr) {\n    if (attr === \"position\") {\n      return this.object3D.position;\n    }\n    if (attr === \"rotation\") {\n      return getRotation(this);\n    }\n    if (attr === \"scale\") {\n      return this.object3D.scale;\n    }\n    if (attr === \"visible\") {\n      return this.object3D.visible;\n    }\n    if (attr === \"class\" || attr === \"mixin\") {\n      console.warn(`FakeEntity el.getAttribute('${attr}') called`, this.object3D);\n      return \"\";\n    }\n    // If component, return component data.\n    const component = this.components[attr];\n    if (component) {\n      return component.data;\n    }\n    throw Error(`FakeEntity el.getAttribute('${attr}') not implemented`);\n  }\n\n  getDOMAttribute(attr) {\n    console.warn(`FakeEntity el.getDOMAttribute('${attr}') called`, this.object3D);\n    return \"\";\n  }\n\n  flushToDOM() {\n    // do nothing\n  }\n\n  removeAttribute() {\n    throw Error(\"FakeEntity el.removeAttribute not implemented\");\n  }\n\n  /**\n   * setAttribute can:\n   *\n   * 1. Set a single property of a multi-property component.\n   * 2. Set multiple properties of a multi-property component.\n   * 3. Replace properties of a multi-property component.\n   * 4. Set a value for a single-property component, ~~mixin, or normal HTML attribute~~.\n   *\n   * @param {string} attrName - Component ~~or attribute~~ name.\n   * @param {*} arg1 - Can be a value, property name, CSS-style property string, or\n   *   object of properties.\n   * @param {*|bool} arg2 - If arg1 is a property name, this should be a value. Otherwise,\n   *   it is a boolean indicating whether to clobber previous values (defaults to false).\n   */\n  setAttribute(componentName, arg1, arg2) {\n    if (componentName.indexOf(MULTIPLE_COMPONENT_DELIMITER) > -1) {\n      throw Error(\n        `FakeEntity setAttribute(\"${componentName}\", ...) using multiple components of the same type is not supported`\n      );\n    }\n    if (!AFRAME.components[componentName]) {\n      if (componentName === \"id\") {\n        // networked component is setting the id to be the same as networkId\n        this.id = arg1;\n        return;\n      }\n      throw Error(`FakeEntity setAttribute(\"${componentName}\", ...) not supported, this is not a registered component`);\n    }\n\n    let newAttrValue, clobber;\n    // Determine new attributes from the arguments\n    if (\n      typeof arg2 !== \"undefined\" &&\n      typeof arg1 === \"string\" &&\n      arg1.length > 0 &&\n      typeof AFRAME.utils.styleParser.parse(arg1) === \"string\"\n    ) {\n      // Update a single property of a multi-property component\n      for (const key in singlePropUpdate) {\n        delete singlePropUpdate[key];\n      }\n      newAttrValue = singlePropUpdate;\n      newAttrValue[arg1] = arg2;\n      clobber = false;\n    } else {\n      // Update with a value, object, or CSS-style property string, with the possiblity\n      // of clobbering previous values.\n      newAttrValue = arg1;\n      clobber = arg2 === true;\n    }\n\n    this.updateComponent(componentName, newAttrValue, clobber);\n  }\n\n  updateComponent(attr, attrValue, clobber) {\n    const component = this.components[attr];\n\n    if (component) {\n      // Remove component.\n      // if (attrValue === null && !checkComponentDefined(this, attr)) {\n      if (attrValue === null) {\n        this.removeComponent(attr, true);\n        return;\n      }\n      // Component already initialized. Update component.\n      component.updateProperties(attrValue, clobber);\n      return;\n    }\n\n    // Component not yet initialized. Initialize component.\n    this.initComponent(attr, attrValue, false);\n  }\n\n  /**\n   * Initialize component.\n   *\n   * @param {string} attrName - Attribute name associated to the component.\n   * @param {object} data - Component data\n   * @param {boolean} isDependency - True if the component is a dependency.\n   */\n  // eslint-disable-next-line\n  initComponent(attrName, data, isDependency) {\n    addComponent(this.object3D, attrName, data);\n  }\n\n  removeComponent(name, destroy) {\n    const component = this.components[name];\n    if (!component) {\n      return;\n    }\n\n    // Wait for component to initialize.\n    if (!component.initialized) {\n      this.addEventListener(\"componentinitialized\", function tryRemoveLater(evt) {\n        if (evt.detail.name !== name) {\n          return;\n        }\n        this.removeComponent(name, destroy);\n        this.removeEventListener(\"componentinitialized\", tryRemoveLater);\n      });\n      return;\n    }\n\n    component.pause();\n    component.remove();\n\n    // Keep component attached to entity in case of just full entity detach.\n    if (destroy) {\n      component.destroy();\n      delete this.components[name];\n    }\n\n    this.emit(\"componentremoved\", component.evtDetail, false);\n  }\n\n  getObject3D(type) {\n    return this.object3DMap[type];\n  }\n\n  /**\n   * Set a THREE.Object3D into the map.\n   *\n   * @param {string} type - Developer-set name of the type of object, will be unique per type.\n   * @param {object} obj - A THREE.Object3D.\n   */\n  setObject3D(type, obj) {\n    // Remove existing object of the type.\n    const oldObj = this.getObject3D(type);\n    if (oldObj) {\n      this.object3D.remove(oldObj);\n    }\n\n    // Set references to this fake entity.\n    obj.el = this;\n    const self = this;\n    if (obj.children.length) {\n      obj.traverse(function bindEl(child) {\n        child.el = self;\n      });\n    }\n\n    // Add.\n    if (obj !== this.object3D) {\n      this.object3D.add(obj);\n    }\n    this.object3DMap[type] = obj;\n    this.emit(\"object3dset\", { object: obj, type: type });\n  }\n\n  /**\n   * Remove object from scene and entity object3D map.\n   */\n  removeObject3D(type) {\n    const obj = this.getObject3D(type);\n    if (!obj) {\n      console.warn(\"Tried to remove `Object3D` of type:\", type, \"which was not defined.\");\n      return;\n    }\n    this.object3D.remove(obj);\n    delete this.object3DMap[type];\n    this.emit(\"object3dremove\", { type: type });\n  }\n\n  emit(name, detail, bubbles, extraData) {\n    if (bubbles === undefined) {\n      bubbles = true;\n    }\n    let data = eventData;\n    data.bubbles = !!bubbles;\n    data.detail = detail;\n\n    // If extra data is present, we need to create a new object.\n    if (extraData) {\n      data = AFRAME.utils.extend({}, extraData, data);\n    }\n\n    // In the default EventDispatcher implementation, dispatchEvent was setting target attribute on the event\n    // but we got an error with CustomEvent instance being readonly. So we're setting it in data first\n    // before creating the CustomEvent.\n    data.target = this;\n    this.dispatchEvent(new CustomEvent(name, data));\n    // And we reset target to null to be sure to not keep a reference to `this` for the garbage collector to work properly.\n    data.target = null;\n  }\n\n  destroy() {\n    for (const name in this.components) {\n      this.removeComponent(name, true);\n    }\n    this.object3D.el = null;\n    this.object3D = null;\n    this.sceneEl = null;\n    this.parentElement = null;\n    this.parentNode = null;\n  }\n}\n","import { FakeEntity } from \"../components/FakeEntity\";\n\nexport const addComponent = (node, componentName, data) => {\n  if (!node.fakeEl) {\n    node.fakeEl = new FakeEntity(node);\n  }\n  const componentId = undefined; // supporting only one component of the same type on a FakeEntity\n  const component = new AFRAME.components[componentName].Component(node.fakeEl, data, componentId);\n  component.play();\n  return component;\n};\n\nexport const createEntityAndReparent = (node, klass = undefined) => {\n  const sceneEl = node.el.sceneEl;\n  const entity = document.createElement(\"a-entity\");\n  if (klass) {\n    entity.classList.add(klass);\n  }\n  sceneEl.appendChild(entity);\n  entity.object3D.removeFromParent();\n  entity.object3D = node;\n  entity.object3D.el = entity;\n  // We assume here that node local position/quaternion is the same as world position/quaternion\n  sceneEl.object3D.attach(node);\n  return entity;\n};\n","import { inflateEnvironmentSettings } from \"./environment-settings\";\nimport { inflateMediaFrame } from \"./media-frame\";\nimport { inflateNavMesh } from \"./nav-mesh\";\nimport { inflateReflectionProbe } from \"./reflection-probe\";\nimport { inflateUVScroll } from \"./uv-scroll\";\nimport { inflateWaypoint } from \"./waypoint\";\n\nexport const gltfInflators = new Map();\ngltfInflators.set(\"environment-settings\", inflateEnvironmentSettings);\ngltfInflators.set(\"media-frame\", inflateMediaFrame);\ngltfInflators.set(\"nav-mesh\", inflateNavMesh);\ngltfInflators.set(\"reflection-probe\", inflateReflectionProbe);\ngltfInflators.set(\"uv-scroll\", inflateUVScroll);\ngltfInflators.set(\"waypoint\", inflateWaypoint);\n","import { createEntityAndReparent } from \"./utils\";\n\nexport function inflateMediaFrame(node, componentProps, otherComponents) {\n  const el = createEntityAndReparent(node);\n  el.classList.add(\"mediaframe\");\n  el.classList.add(node.name); // to view it in the editor\n\n  // Set networked component first, media-frame is getting the networkId from networked component\n  el.setAttribute(\"networked\", {\n    template: \"#media-template\",\n    attachTemplateToLocal: false,\n    networkId: otherComponents.networked.id,\n    persistent: true,\n    owner: \"scene\",\n  });\n  if (NAF.connection.adapter) {\n    el.setAttribute(\"networked-video-source\", {});\n  } else {\n    const listener = () => {\n      el.setAttribute(\"networked-video-source\", {});\n    };\n    document.body.addEventListener(\"connected\", listener);\n  }\n  el.setAttribute(\"media-frame\", componentProps);\n\n  return el;\n}\n","export function inflateNavMesh(node, componentProps, otherComponents) {\n  const sceneEl = node.el.sceneEl;\n\n  const el = document.createElement(\"a-entity\");\n  // Very important, add the class before appendChild.\n  // The blink-controls component is using the child-attached event and will do a\n  // evt.detail.el.matches(data.collisionEntities)) check,\n  // so el.matches('.navmesh') before adding the element to collisionEntities array.\n  el.classList.add(\"navmesh\");\n  el.setAttribute(\"nav-mesh\", \"\");\n  sceneEl.appendChild(el);\n  el.setObject3D(\"mesh\", node);\n  // Reset simple-navmesh-constraint\n  // Temporary until we add child-attached/child-detached support in simple-navmesh-constraint\n  // https://github.com/networked-aframe/naf-valid-avatars/issues/28\n  const cameraRig = document.querySelector(\"#rig,#cameraRig\");\n  if (cameraRig) {\n    cameraRig.removeAttribute(\"simple-navmesh-constraint\");\n    cameraRig.setAttribute(\"simple-navmesh-constraint\", \"navmesh:.navmesh;fall:0.5;height:0;exclude:.navmesh-hole;\");\n  }\n  return el;\n}\n","/* global THREE */\nimport { addComponent } from \"./utils\";\n\nexport function inflateReflectionProbe(node, componentProps, otherComponents) {\n  if (typeof THREE.ReflectionProbe === \"undefined\") {\n    console.error(\"You need an aframe build with the ReflectionProbe patch to make reflection probes work.\");\n    return;\n  }\n  // TODO PMREMGenerator should be fixed to not assume this\n  componentProps.envMapTexture.flipY = true;\n  // Assume texture is always an equirect for now\n  componentProps.envMapTexture.mapping = THREE.EquirectangularReflectionMapping;\n  addComponent(node, \"reflection-probe\", componentProps);\n}\n","import { addComponent } from \"./utils\";\nimport { FakeEntity } from \"../components/FakeEntity\";\n\nexport function inflateUVScroll(node, componentProps, otherComponents) {\n  // set the node (plane geometry) as the 'mesh' first\n  node.fakeEl = new FakeEntity(node);\n  node.fakeEl.setObject3D(\"mesh\", node);\n  // then add uv-scroll that uses getObject3D(\"mesh\")\n  addComponent(node, \"uv-scroll\", componentProps);\n}\n","import { createEntityAndReparent } from \"./utils\";\n\nexport function inflateWaypoint(node, componentProps, otherComponents) {\n  const el = createEntityAndReparent(node);\n\n  if (componentProps.canBeOccupied) {\n    el.setAttribute(\"networked\", {\n      template: \"#waypoint-template\",\n      attachTemplateToLocal: false,\n      networkId: otherComponents.networked.id,\n      persistent: true,\n      owner: \"scene\",\n    });\n  }\n\n  el.setAttribute(\"waypoint\", componentProps);\n\n  if (componentProps.canBeClicked && componentProps.canBeOccupied) {\n    if (componentProps.willDisableMotion) {\n      el.setAttribute(\"gltf-model\", \"/models/waypoint_sit.glb\");\n    } else {\n      el.setAttribute(\"gltf-model\", \"/models/waypoint_stand.glb\");\n    }\n  }\n\n  return el;\n}\n","/* global AFRAME, THREE */\nimport { RGBELoader } from \"three/addons/loaders/RGBELoader.js\";\nimport { gltfInflators } from \"../inflators\";\n\nconst HDR_FILE_RE = /\\.hdr$/;\n\nconst absoluteURLForAsset =\n  window.absoluteURLForAsset ||\n  ((asset) => {\n    return asset;\n  });\n\n// same defaults as the defaultEnvironmentSettings function\nAFRAME.registerComponent(\"environment-settings\", {\n  schema: {\n    toneMapping: {\n      type: \"string\",\n      default: \"LUTToneMapping\",\n      oneOf: [\n        \"NoToneMapping\",\n        \"LinearToneMapping\",\n        \"ReinhardToneMapping\",\n        \"CineonToneMapping\",\n        \"ACESFilmicToneMapping\",\n        \"CustomToneMapping\",\n        \"LUTToneMapping\",\n      ],\n    },\n    toneMappingExposure: {\n      type: \"number\",\n      default: 1,\n    },\n    backgroundTexture: {\n      type: \"string\",\n      default: \"\",\n    },\n    backgroundColor: {\n      type: \"color\",\n      default: \"skyblue\",\n    },\n    envMapTexture: {\n      type: \"string\",\n      default: \"\",\n    },\n  },\n  init() {\n    (async () => {\n      let backgroundTexture = null;\n      if (this.data.backgroundTexture) {\n        const backgroundTextureUrl = absoluteURLForAsset(this.data.backgroundTexture);\n        const isHDR = HDR_FILE_RE.test(backgroundTextureUrl);\n        let loader;\n        if (isHDR) {\n          loader = new RGBELoader().setDataType(THREE.HalfFloatType);\n        } else {\n          loader = new THREE.TextureLoader();\n        }\n\n        loader.setWithCredentials(false);\n        backgroundTexture = await new Promise((resolve, reject) =>\n          loader.load(backgroundTextureUrl, resolve, undefined, reject)\n        );\n        if (\n          backgroundTexture.minFilter === THREE.NearestMipmapNearestFilter ||\n          backgroundTexture.minFilter === THREE.NearestMipmapLinearFilter\n        ) {\n          backgroundTexture.minFilter = THREE.NearestFilter;\n        } else if (\n          backgroundTexture.minFilter === THREE.LinearMipmapNearestFilter ||\n          backgroundTexture.minFilter === THREE.LinearMipmapLinearFilter\n        ) {\n          backgroundTexture.minFilter = THREE.LinearFilter;\n        }\n\n        if (!isHDR) {\n          backgroundTexture.encoding = THREE.sRGBEncoding;\n        }\n      }\n\n      let envMapTexture = null;\n      if (this.data.envMapTexture) {\n        const envMapTextureUrl = absoluteURLForAsset(this.data.envMapTexture);\n        const isHDR = HDR_FILE_RE.test(envMapTextureUrl);\n        let loader;\n        if (isHDR) {\n          loader = new RGBELoader().setDataType(THREE.HalfFloatType);\n        } else {\n          loader = new THREE.TextureLoader();\n        }\n\n        loader.setWithCredentials(false);\n        envMapTexture = await new Promise((resolve, reject) =>\n          loader.load(envMapTextureUrl, resolve, undefined, reject)\n        );\n        if (\n          envMapTexture.minFilter === THREE.NearestMipmapNearestFilter ||\n          envMapTexture.minFilter === THREE.NearestMipmapLinearFilter\n        ) {\n          envMapTexture.minFilter = THREE.NearestFilter;\n        } else if (\n          envMapTexture.minFilter === THREE.LinearMipmapNearestFilter ||\n          envMapTexture.minFilter === THREE.LinearMipmapLinearFilter\n        ) {\n          envMapTexture.minFilter = THREE.LinearFilter;\n        }\n\n        if (!isHDR) {\n          envMapTexture.encoding = THREE.sRGBEncoding;\n        }\n      }\n\n      const settings = {\n        toneMapping: this.data.toneMapping,\n        toneMappingExposure: this.data.toneMappingExposure,\n        backgroundTexture: backgroundTexture,\n        backgroundColor: this.data.backgroundColor,\n        envMapTexture: envMapTexture,\n      };\n      gltfInflators.get(\"environment-settings\")(this.el.sceneEl, settings);\n    })();\n  },\n});\n","/* global AFRAME, NAF, THREE */\nimport { RGBELoader } from \"three/addons/loaders/RGBELoader.js\";\nimport { defaultEnvironmentSettings } from \"../inflators/environment-settings\";\nimport { gltfInflators } from \"../inflators\";\n\nclass GLTFMozTextureRGBE {\n  constructor(parser, loader) {\n    this.parser = parser;\n    this.loader = loader;\n    this.name = \"MOZ_texture_rgbe\";\n  }\n\n  loadTexture(textureIndex) {\n    const parser = this.parser;\n    const json = parser.json;\n    const textureDef = json.textures[textureIndex];\n\n    if (!textureDef.extensions || !textureDef.extensions[this.name]) {\n      return null;\n    }\n\n    const extensionDef = textureDef.extensions[this.name];\n    const source = extensionDef.source;\n\n    return parser\n      .loadTextureImage(textureIndex, source, this.loader)\n      .then((t) => {\n        // TODO pretty severe artifacting when using mipmaps, disable for now\n        if (t.minFilter === THREE.NearestMipmapNearestFilter || t.minFilter === THREE.NearestMipmapLinearFilter) {\n          t.minFilter = THREE.NearestFilter;\n        } else if (t.minFilter === THREE.LinearMipmapNearestFilter || t.minFilter === THREE.LinearMipmapLinearFilter) {\n          t.minFilter = THREE.LinearFilter;\n        }\n        return t;\n      })\n      .catch((error) => {\n        console.error(\"issue while loading hdr texture\", error);\n      });\n  }\n}\n\nexport function mapMaterials(object3D, fn) {\n  if (!object3D.material) return [];\n\n  if (Array.isArray(object3D.material)) {\n    return object3D.material.map(fn);\n  } else {\n    return [fn(object3D.material)];\n  }\n}\n\nclass GLTFHubsComponentsExtension {\n  constructor(parser) {\n    this.parser = parser;\n    this.name = \"MOZ_hubs_components\";\n  }\n\n  afterRoot({ scenes, parser }) {\n    const deps = [];\n\n    const resolveComponents = (gltfRootType, obj) => {\n      const idx = parser.associations.get(obj)?.[gltfRootType];\n      // parser.associations.get(obj) will be undefined if you have two scenes in the gltf because of\n      // parser.associations = reduceAssociations( scene );\n      // line causing parser.associations to be cleaned when loading the second scene.\n      // https://github.com/mrdoob/three.js/blob/c965d3b5dcab2575d6a73aec583c29fa44c0c60d/examples/jsm/loaders/GLTFLoader.js#L4373\n      // console.log(obj.name, parser.associations.get(obj), gltfRootType, idx, parser.json[gltfRootType][idx]);\n      // Empty undefined nodes undefined undefined\n      // Be sure to export with \"Include / Active Scene\" checked in blender to have only one scene in the gltf\n      if (idx === undefined) return;\n      const ext = parser.json[gltfRootType][idx].extensions?.[this.name];\n\n      if (!ext) return;\n      // console.log(obj.name, { ext });\n\n      // TODO putting this into userData is a bit silly, we should just inflate here, but entities need to be inflated first...\n      obj.userData.gltfExtensions = Object.assign(obj.userData.gltfExtensions || {}, {\n        MOZ_hubs_components: ext,\n      });\n\n      for (const componentName in ext) {\n        const props = ext[componentName];\n        for (const propName in props) {\n          const value = props[propName];\n          const type = value?.__mhc_link_type;\n          if (type && value.index !== undefined) {\n            deps.push(\n              parser.getDependency(type, value.index).then((loadedDep) => {\n                // TODO similar to above, this logic being spread out in multiple places is not great...\n                // Node refences are assumed to always be in the scene graph. These referneces are late-resolved in inflateComponents\n                // otherwise they will need to be updated when cloning (which happens as part of caching).\n                if (type === \"node\") return;\n\n                if (type === \"texture\" && !parser.json.textures[value.index].extensions?.MOZ_texture_rgbe) {\n                  // For now assume all non HDR textures linked in hubs components are sRGB.\n                  // We can allow this to be overriden later if needed\n                  loadedDep.encoding = THREE.sRGBEncoding;\n                }\n\n                props[propName] = loadedDep;\n\n                return loadedDep;\n              })\n            );\n          }\n        }\n      }\n    };\n\n    // object.userData.gltfExtensions.MOZ_hubs_components is not set because we have a plugin registered for MOZ_hubs_components\n    // https://github.com/mrdoob/three.js/blob/c965d3b5dcab2575d6a73aec583c29fa44c0c60d/examples/jsm/loaders/GLTFLoader.js#L2330-L2335\n    // called here\n    // https://github.com/mrdoob/three.js/blob/c965d3b5dcab2575d6a73aec583c29fa44c0c60d/examples/jsm/loaders/GLTFLoader.js#L4264\n    // that's why we traverse all scenes, nodes, materials to set MOZ_hubs_components\n    // Actually we're only interested by transforming envMapTexture and backgroundTexture for scene MOZ_hubs_components.environment-settings\n    // and reflection probes textures\n    for (let i = 0; i < scenes.length; i++) {\n      // TODO this should be done by GLTLoader\n      parser.associations.set(scenes[i], { scenes: i });\n      scenes[i].traverse((obj) => {\n        resolveComponents(\"scenes\", obj);\n        resolveComponents(\"nodes\", obj);\n        mapMaterials(obj, resolveComponents.bind(this, \"materials\"));\n      });\n    }\n\n    return Promise.all(deps);\n  }\n}\n\nclass GLTFHubsLightMapExtension {\n  constructor(parser) {\n    this.parser = parser;\n    this.name = \"MOZ_lightmap\";\n  }\n\n  // @TODO: Ideally we should use extendMaterialParams hook.\n  //        But the current official glTF loader doesn't fire extendMaterialParams\n  //        hook for unlit and specular-glossiness materials.\n  //        So using loadMaterial hook as workaround so far.\n  //        Cons is loadMaterial hook is fired as _invokeOne so\n  //        if other plugins defining loadMaterial is registered\n  //        there is a chance that this light map extension handler isn't called.\n  //        The glTF loader should be updated to remove the limitation.\n  loadMaterial(materialIndex) {\n    const parser = this.parser;\n    const json = parser.json;\n    const materialDef = json.materials[materialIndex];\n    if (!materialDef.extensions || !materialDef.extensions[this.name]) {\n      return null;\n    }\n\n    const extensionDef = materialDef.extensions[this.name];\n\n    const pending = [];\n    pending.push(parser.loadMaterial(materialIndex));\n    pending.push(parser.getDependency(\"texture\", extensionDef.index));\n\n    return Promise.all(pending)\n      .then((results) => {\n        const material = results[0];\n        const lightMap = results[1];\n        material.lightMap = lightMap;\n        material.lightMapIntensity = extensionDef.intensity !== undefined ? extensionDef.intensity : 1;\n        if (material.isMeshBasicMaterial) {\n          material.lightMapIntensity *= Math.PI;\n        }\n        return material;\n      })\n      .catch((error) => {\n        console.error(\"issue while loading MOZ_lightmap material\", error);\n      });\n  }\n}\n\nfunction disposeTextures(material) {\n  // Explicitly dispose any textures assigned to this material\n  for (const propertyName in material) {\n    const texture = material[propertyName];\n    if (texture instanceof THREE.Texture) {\n      const image = texture.source.data;\n      if (image instanceof ImageBitmap) {\n        image.close && image.close();\n      }\n      texture.dispose();\n    }\n  }\n}\n\nexport function disposeNode(node) {\n  if (node.fakeEl) {\n    node.fakeEl.destroy();\n  }\n  if (node instanceof THREE.Mesh) {\n    const geometry = node.geometry;\n    if (geometry) {\n      geometry.dispose();\n    }\n\n    const material = node.material;\n    if (material) {\n      if (Array.isArray(material)) {\n        for (let i = 0, l = material.length; i < l; i++) {\n          const m = material[i];\n          disposeTextures(m);\n          m.dispose();\n        }\n      } else {\n        disposeTextures(material);\n        material.dispose(); // disposes any programs associated with the material\n      }\n    }\n  }\n}\nexport const gltfModelPlus = {\n  schema: { type: \"model\" },\n\n  init: function () {\n    const self = this;\n    const dracoLoader = this.el.sceneEl.systems[\"gltf-model\"].getDRACOLoader();\n    const meshoptDecoder = this.el.sceneEl.systems[\"gltf-model\"].getMeshoptDecoder();\n    const ktxLoader = this.el.sceneEl.systems[\"gltf-model\"].getKTX2Loader();\n    this.model = null;\n    this.removers = [];\n    this.loader = new THREE.GLTFLoader();\n    this.mixer = null;\n    this.loader\n      .register((parser) => new GLTFHubsComponentsExtension(parser))\n      .register((parser) => new GLTFHubsLightMapExtension(parser))\n      .register((parser) => new GLTFMozTextureRGBE(parser, new RGBELoader().setDataType(THREE.HalfFloatType)));\n    if (dracoLoader) {\n      this.loader.setDRACOLoader(dracoLoader);\n    }\n    if (meshoptDecoder) {\n      this.ready = meshoptDecoder.then(function (meshoptDecoder) {\n        self.loader.setMeshoptDecoder(meshoptDecoder);\n      });\n    } else {\n      this.ready = Promise.resolve();\n    }\n    if (ktxLoader) {\n      this.loader.setKTX2Loader(ktxLoader);\n    }\n  },\n\n  update: function () {\n    const self = this;\n    const el = this.el;\n    const src = this.data;\n\n    this.remove();\n\n    if (!src) {\n      return;\n    }\n\n    this.ready.then(function () {\n      self.el.emit(\"model-loading\", { src });\n      self.loader.load(\n        src,\n        function gltfLoaded(gltfModel) {\n          el.emit(\"model-downloaded\");\n          self.model = gltfModel.scene || gltfModel.scenes[0];\n          self.model.animations = gltfModel.animations;\n          el.setObject3D(\"mesh\", self.model);\n\n          // Handle Hubs components\n          const animations = gltfModel.animations;\n          const finalizers = [];\n          let environmentSettings = null;\n          gltfModel.scene.traverse((node) => {\n            if (node.isMesh) {\n              node.reflectionProbeMode = \"static\";\n            }\n\n            if (node.userData.gltfExtensions && node.userData.gltfExtensions.MOZ_hubs_components) {\n              const hubsComponents = node.userData.gltfExtensions.MOZ_hubs_components;\n              console.log(src, hubsComponents, node.name);\n              Object.entries(hubsComponents).forEach(([componentName, componentProps]) => {\n                if (componentName === \"environment-settings\") {\n                  environmentSettings = componentProps;\n                } else if (componentName === \"visible\") {\n                  node.visible = componentProps.visible;\n                } else if (componentName === \"networked\") {\n                  // ignore, handled in other inflators\n                } else if (componentName === \"loop-animation\") {\n                  if (!self.mixer) {\n                    self.mixer = new THREE.AnimationMixer(gltfModel.scene);\n                    // add tick\n                    self.tick = function (t, dt) {\n                      if (self.mixer && !isNaN(dt)) self.mixer.update(dt / 1000);\n                    };\n                    self.el.sceneEl.addBehavior(self);\n                  }\n                  const activeClipIndices = componentProps.activeClipIndices;\n                  let clips = [];\n                  if (activeClipIndices && activeClipIndices.length > 0) {\n                    // Support for Spoke->Hubs activeClipIndices struct\n                    clips = activeClipIndices.map((index) => animations[index]);\n                  } else {\n                    // Support for Blender imports with { clip: 'train', paused: false} struct.\n                    const clipName = componentProps.clip;\n                    if (clipName !== \"\") {\n                      const clipNames = clipName.split(\",\");\n                      for (let i = 0; i < clipNames.length; i++) {\n                        const n = clipNames[i];\n                        const a = animations.find(({ name }) => name === n);\n                        if (a) {\n                          clips.push(a);\n                        } else {\n                          console.warn(`Could not find animation named '${n}'`);\n                        }\n                      }\n                    }\n                  }\n\n                  for (let i = 0; i < clips.length; i++) {\n                    const action = self.mixer.clipAction(clips[i], node);\n                    action.enabled = true;\n                    action.setLoop(THREE.LoopRepeat, Infinity).play();\n                  }\n                } else {\n                  const inflator = gltfInflators.get(componentName);\n                  if (inflator) {\n                    // Create entity and move node to a different parent when we're done traversing the scene\n                    finalizers.push(() => {\n                      const entity = inflator(node, componentProps, hubsComponents);\n                      if (entity) {\n                        self.removers.push(() => {\n                          entity.object3D.traverse(disposeNode);\n                          if (entity.parentNode) entity.parentNode.removeChild(entity);\n                          if (componentName === \"nav-mesh\") {\n                            // Temporary until we add child-attached/child-detached support in simple-navmesh-constraint\n                            // https://github.com/networked-aframe/naf-valid-avatars/issues/28\n                            const cameraRig = document.querySelector(\"#rig,#cameraRig\");\n                            cameraRig?.removeAttribute(\"simple-navmesh-constraint\");\n                          }\n                        });\n                      }\n                    });\n                  } else {\n                    console.warn(`Unknown Hubs component '${componentName}'`);\n                  }\n                }\n              });\n            }\n          });\n\n          if (!environmentSettings) {\n            environmentSettings = defaultEnvironmentSettings;\n          }\n\n          if (self.el.classList.contains(\"environment-settings\")) {\n            gltfInflators.get(\"environment-settings\")(self.el.sceneEl, environmentSettings);\n          }\n\n          for (let i = 0; i < finalizers.length; i++) {\n            finalizers[i]();\n          }\n          finalizers.length = 0;\n\n          el.emit(\"model-loaded\", { format: \"gltf\", model: self.model, environmentSettings });\n          setTimeout(() => {\n            el.sceneEl.renderer.shadowMap.needsUpdate = true;\n          }, 2000);\n        },\n        function onProgress(evt) {\n          el.emit(\"progress\", { originalEvent: evt });\n        },\n        function gltfFailed(error) {\n          el.emit(\"model-downloaded\");\n          console.error(error, src);\n          const message = error && error.message ? error.message : \"Failed to load glTF model\";\n          console.warn(message);\n          el.emit(\"model-error\", { format: \"gltf\", src: src });\n        }\n      );\n    });\n  },\n\n  remove: function () {\n    if (!this.model) {\n      return;\n    }\n\n    if (this.mixer) {\n      this.mixer.stopAllAction();\n      this.mixer = null;\n      // remove tick\n      this.el.sceneEl.removeBehavior(this);\n      this.tick = undefined;\n    }\n\n    for (let i = 0; i < this.removers.length; i++) {\n      this.removers[i]();\n    }\n    this.removers.length = 0;\n\n    this.el.removeObject3D(\"mesh\");\n    this.model.traverse(disposeNode);\n    this.model = null;\n  },\n};\n\nAFRAME.registerComponent(\"gltf-model-plus\", gltfModelPlus);\n","/* global AFRAME, THREE */\nconst registeredMediaframes = [];\nconst mediaFramesById = new Map();\n\nAFRAME.registerSystem(\"media-frame\", {\n  getClosestMediaFrame: function (filterByMediaType) {\n    let mediaFrames = registeredMediaframes;\n    if (filterByMediaType && filterByMediaType !== \"all\") {\n      if (filterByMediaType === \"all-2d\") {\n        mediaFrames = mediaFrames.filter((mediaFrame) => {\n          const mediaType = mediaFrame.component.data.mediaType;\n          return mediaType !== \"model\";\n        });\n      } else {\n        if (filterByMediaType === \"model\") {\n          mediaFrames = mediaFrames.filter((mediaFrame) => {\n            const mediaType = mediaFrame.component.data.mediaType;\n            return mediaType === filterByMediaType || mediaType === \"all\";\n          });\n        } else {\n          mediaFrames = mediaFrames.filter((mediaFrame) => {\n            const mediaType = mediaFrame.component.data.mediaType;\n            return mediaType === filterByMediaType || mediaType === \"all\" || mediaType === \"all-2d\";\n          });\n        }\n      }\n    }\n    const cameraRigPosition = document.querySelector(\"#rig,#cameraRig\").object3D.position;\n    // Note: assumption that object3D.position is global world coordinate here\n    mediaFrames.sort((a, b) => {\n      if (a.el.object3D.position.distanceTo(cameraRigPosition) < b.el.object3D.position.distanceTo(cameraRigPosition)) {\n        return -1;\n      }\n      return 1;\n    });\n    if (mediaFrames.length > 0) {\n      return mediaFrames[0];\n    }\n    return document.getElementById(\"screenshare\"); // TODO remove this hard coded value\n  },\n  getMediaFrameById(id) {\n    const mediaFrame = mediaFramesById.get(id);\n    if (!mediaFrame) return document.getElementById(\"screenshare\"); // TODO remove this hard coded value\n    return mediaFrame.el;\n  },\n});\n\n/**\n * Define a location where you can put 2d or 3d elements\n * @component media-frame\n */\nexport const mediaFrameComponent = AFRAME.registerComponent(\"media-frame\", {\n  schema: {\n    bounds: { type: \"vec3\", default: { x: 1, y: 1, z: 1 } },\n    mediaType: { type: \"string\", oneOf: [\"all\", \"all-2d\", \"model\", \"image\", \"video\", \"pdf\"], default: \"all-2d\" },\n    snapToCenter: { type: \"boolean\", default: true },\n  },\n  play() {\n    const id = this.el.components.networked.data.networkId;\n    const instance = { component: this, el: this.el, id };\n    this.instance = instance;\n    mediaFramesById.set(id, instance);\n    registeredMediaframes.push(instance);\n  },\n\n  pause() {\n    mediaFramesById.delete(this.instance.id);\n    registeredMediaframes.splice(registeredMediaframes.indexOf(this.instance), 1);\n  },\n});\n","// Ported from Stefan Gustavson's java implementation\n// http://staffwww.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf\n// Read Stefan's excellent paper for details on how this code works.\n//\n// Sean McCullough banksean@gmail.com\n//\n// Added 4D noise\n\n/**\n * You can pass in a random number generator object if you like.\n * It is assumed to have a random() method.\n */\nclass SimplexNoise {\n\n\tconstructor( r = Math ) {\n\n\t\tthis.grad3 = [[ 1, 1, 0 ], [ - 1, 1, 0 ], [ 1, - 1, 0 ], [ - 1, - 1, 0 ],\n\t\t\t[ 1, 0, 1 ], [ - 1, 0, 1 ], [ 1, 0, - 1 ], [ - 1, 0, - 1 ],\n\t\t\t[ 0, 1, 1 ], [ 0, - 1, 1 ], [ 0, 1, - 1 ], [ 0, - 1, - 1 ]];\n\n\t\tthis.grad4 = [[ 0, 1, 1, 1 ], [ 0, 1, 1, - 1 ], [ 0, 1, - 1, 1 ], [ 0, 1, - 1, - 1 ],\n\t\t\t[ 0, - 1, 1, 1 ], [ 0, - 1, 1, - 1 ], [ 0, - 1, - 1, 1 ], [ 0, - 1, - 1, - 1 ],\n\t\t\t[ 1, 0, 1, 1 ], [ 1, 0, 1, - 1 ], [ 1, 0, - 1, 1 ], [ 1, 0, - 1, - 1 ],\n\t\t\t[ - 1, 0, 1, 1 ], [ - 1, 0, 1, - 1 ], [ - 1, 0, - 1, 1 ], [ - 1, 0, - 1, - 1 ],\n\t\t\t[ 1, 1, 0, 1 ], [ 1, 1, 0, - 1 ], [ 1, - 1, 0, 1 ], [ 1, - 1, 0, - 1 ],\n\t\t\t[ - 1, 1, 0, 1 ], [ - 1, 1, 0, - 1 ], [ - 1, - 1, 0, 1 ], [ - 1, - 1, 0, - 1 ],\n\t\t\t[ 1, 1, 1, 0 ], [ 1, 1, - 1, 0 ], [ 1, - 1, 1, 0 ], [ 1, - 1, - 1, 0 ],\n\t\t\t[ - 1, 1, 1, 0 ], [ - 1, 1, - 1, 0 ], [ - 1, - 1, 1, 0 ], [ - 1, - 1, - 1, 0 ]];\n\n\t\tthis.p = [];\n\n\t\tfor ( let i = 0; i < 256; i ++ ) {\n\n\t\t\tthis.p[ i ] = Math.floor( r.random() * 256 );\n\n\t\t}\n\n\t\t// To remove the need for index wrapping, double the permutation table length\n\t\tthis.perm = [];\n\n\t\tfor ( let i = 0; i < 512; i ++ ) {\n\n\t\t\tthis.perm[ i ] = this.p[ i & 255 ];\n\n\t\t}\n\n\t\t// A lookup table to traverse the simplex around a given point in 4D.\n\t\t// Details can be found where this table is used, in the 4D noise method.\n\t\tthis.simplex = [\n\t\t\t[ 0, 1, 2, 3 ], [ 0, 1, 3, 2 ], [ 0, 0, 0, 0 ], [ 0, 2, 3, 1 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 1, 2, 3, 0 ],\n\t\t\t[ 0, 2, 1, 3 ], [ 0, 0, 0, 0 ], [ 0, 3, 1, 2 ], [ 0, 3, 2, 1 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 1, 3, 2, 0 ],\n\t\t\t[ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ],\n\t\t\t[ 1, 2, 0, 3 ], [ 0, 0, 0, 0 ], [ 1, 3, 0, 2 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 2, 3, 0, 1 ], [ 2, 3, 1, 0 ],\n\t\t\t[ 1, 0, 2, 3 ], [ 1, 0, 3, 2 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 2, 0, 3, 1 ], [ 0, 0, 0, 0 ], [ 2, 1, 3, 0 ],\n\t\t\t[ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ],\n\t\t\t[ 2, 0, 1, 3 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 3, 0, 1, 2 ], [ 3, 0, 2, 1 ], [ 0, 0, 0, 0 ], [ 3, 1, 2, 0 ],\n\t\t\t[ 2, 1, 0, 3 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 0, 0, 0, 0 ], [ 3, 1, 0, 2 ], [ 0, 0, 0, 0 ], [ 3, 2, 0, 1 ], [ 3, 2, 1, 0 ]];\n\n\t}\n\n\tdot( g, x, y ) {\n\n\t\treturn g[ 0 ] * x + g[ 1 ] * y;\n\n\t}\n\n\tdot3( g, x, y, z ) {\n\n\t\treturn g[ 0 ] * x + g[ 1 ] * y + g[ 2 ] * z;\n\n\t}\n\n\tdot4( g, x, y, z, w ) {\n\n\t\treturn g[ 0 ] * x + g[ 1 ] * y + g[ 2 ] * z + g[ 3 ] * w;\n\n\t}\n\n\tnoise( xin, yin ) {\n\n\t\tlet n0; // Noise contributions from the three corners\n\t\tlet n1;\n\t\tlet n2;\n\t\t// Skew the input space to determine which simplex cell we're in\n\t\tconst F2 = 0.5 * ( Math.sqrt( 3.0 ) - 1.0 );\n\t\tconst s = ( xin + yin ) * F2; // Hairy factor for 2D\n\t\tconst i = Math.floor( xin + s );\n\t\tconst j = Math.floor( yin + s );\n\t\tconst G2 = ( 3.0 - Math.sqrt( 3.0 ) ) / 6.0;\n\t\tconst t = ( i + j ) * G2;\n\t\tconst X0 = i - t; // Unskew the cell origin back to (x,y) space\n\t\tconst Y0 = j - t;\n\t\tconst x0 = xin - X0; // The x,y distances from the cell origin\n\t\tconst y0 = yin - Y0;\n\n\t\t// For the 2D case, the simplex shape is an equilateral triangle.\n\t\t// Determine which simplex we are in.\n\t\tlet i1; // Offsets for second (middle) corner of simplex in (i,j) coords\n\n\t\tlet j1;\n\t\tif ( x0 > y0 ) {\n\n\t\t\ti1 = 1; j1 = 0;\n\n\t\t\t// lower triangle, XY order: (0,0)->(1,0)->(1,1)\n\n\t\t}\telse {\n\n\t\t\ti1 = 0; j1 = 1;\n\n\t\t} // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n\n\t\t// A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n\t\t// a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n\t\t// c = (3-sqrt(3))/6\n\t\tconst x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n\t\tconst y1 = y0 - j1 + G2;\n\t\tconst x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\n\t\tconst y2 = y0 - 1.0 + 2.0 * G2;\n\t\t// Work out the hashed gradient indices of the three simplex corners\n\t\tconst ii = i & 255;\n\t\tconst jj = j & 255;\n\t\tconst gi0 = this.perm[ ii + this.perm[ jj ] ] % 12;\n\t\tconst gi1 = this.perm[ ii + i1 + this.perm[ jj + j1 ] ] % 12;\n\t\tconst gi2 = this.perm[ ii + 1 + this.perm[ jj + 1 ] ] % 12;\n\t\t// Calculate the contribution from the three corners\n\t\tlet t0 = 0.5 - x0 * x0 - y0 * y0;\n\t\tif ( t0 < 0 ) n0 = 0.0;\n\t\telse {\n\n\t\t\tt0 *= t0;\n\t\t\tn0 = t0 * t0 * this.dot( this.grad3[ gi0 ], x0, y0 ); // (x,y) of grad3 used for 2D gradient\n\n\t\t}\n\n\t\tlet t1 = 0.5 - x1 * x1 - y1 * y1;\n\t\tif ( t1 < 0 ) n1 = 0.0;\n\t\telse {\n\n\t\t\tt1 *= t1;\n\t\t\tn1 = t1 * t1 * this.dot( this.grad3[ gi1 ], x1, y1 );\n\n\t\t}\n\n\t\tlet t2 = 0.5 - x2 * x2 - y2 * y2;\n\t\tif ( t2 < 0 ) n2 = 0.0;\n\t\telse {\n\n\t\t\tt2 *= t2;\n\t\t\tn2 = t2 * t2 * this.dot( this.grad3[ gi2 ], x2, y2 );\n\n\t\t}\n\n\t\t// Add contributions from each corner to get the final noise value.\n\t\t// The result is scaled to return values in the interval [-1,1].\n\t\treturn 70.0 * ( n0 + n1 + n2 );\n\n\t}\n\n\t// 3D simplex noise\n\tnoise3d( xin, yin, zin ) {\n\n\t\tlet n0; // Noise contributions from the four corners\n\t\tlet n1;\n\t\tlet n2;\n\t\tlet n3;\n\t\t// Skew the input space to determine which simplex cell we're in\n\t\tconst F3 = 1.0 / 3.0;\n\t\tconst s = ( xin + yin + zin ) * F3; // Very nice and simple skew factor for 3D\n\t\tconst i = Math.floor( xin + s );\n\t\tconst j = Math.floor( yin + s );\n\t\tconst k = Math.floor( zin + s );\n\t\tconst G3 = 1.0 / 6.0; // Very nice and simple unskew factor, too\n\t\tconst t = ( i + j + k ) * G3;\n\t\tconst X0 = i - t; // Unskew the cell origin back to (x,y,z) space\n\t\tconst Y0 = j - t;\n\t\tconst Z0 = k - t;\n\t\tconst x0 = xin - X0; // The x,y,z distances from the cell origin\n\t\tconst y0 = yin - Y0;\n\t\tconst z0 = zin - Z0;\n\n\t\t// For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n\t\t// Determine which simplex we are in.\n\t\tlet i1; // Offsets for second corner of simplex in (i,j,k) coords\n\n\t\tlet j1;\n\t\tlet k1;\n\t\tlet i2; // Offsets for third corner of simplex in (i,j,k) coords\n\t\tlet j2;\n\t\tlet k2;\n\t\tif ( x0 >= y0 ) {\n\n\t\t\tif ( y0 >= z0 ) {\n\n\t\t\t\ti1 = 1; j1 = 0; k1 = 0; i2 = 1; j2 = 1; k2 = 0;\n\n\t\t\t\t// X Y Z order\n\n\t\t\t} else if ( x0 >= z0 ) {\n\n\t\t\t\ti1 = 1; j1 = 0; k1 = 0; i2 = 1; j2 = 0; k2 = 1;\n\n\t\t\t\t// X Z Y order\n\n\t\t\t} else {\n\n\t\t\t\ti1 = 0; j1 = 0; k1 = 1; i2 = 1; j2 = 0; k2 = 1;\n\n\t\t\t} // Z X Y order\n\n\t\t} else { // x0<y0\n\n\t\t\tif ( y0 < z0 ) {\n\n\t\t\t\ti1 = 0; j1 = 0; k1 = 1; i2 = 0; j2 = 1; k2 = 1;\n\n\t\t\t\t// Z Y X order\n\n\t\t\t} else if ( x0 < z0 ) {\n\n\t\t\t\ti1 = 0; j1 = 1; k1 = 0; i2 = 0; j2 = 1; k2 = 1;\n\n\t\t\t\t// Y Z X order\n\n\t\t\t} else {\n\n\t\t\t\ti1 = 0; j1 = 1; k1 = 0; i2 = 1; j2 = 1; k2 = 0;\n\n\t\t\t} // Y X Z order\n\n\t\t}\n\n\t\t// A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n\t\t// a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n\t\t// a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n\t\t// c = 1/6.\n\t\tconst x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\n\t\tconst y1 = y0 - j1 + G3;\n\t\tconst z1 = z0 - k1 + G3;\n\t\tconst x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\n\t\tconst y2 = y0 - j2 + 2.0 * G3;\n\t\tconst z2 = z0 - k2 + 2.0 * G3;\n\t\tconst x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\n\t\tconst y3 = y0 - 1.0 + 3.0 * G3;\n\t\tconst z3 = z0 - 1.0 + 3.0 * G3;\n\t\t// Work out the hashed gradient indices of the four simplex corners\n\t\tconst ii = i & 255;\n\t\tconst jj = j & 255;\n\t\tconst kk = k & 255;\n\t\tconst gi0 = this.perm[ ii + this.perm[ jj + this.perm[ kk ] ] ] % 12;\n\t\tconst gi1 = this.perm[ ii + i1 + this.perm[ jj + j1 + this.perm[ kk + k1 ] ] ] % 12;\n\t\tconst gi2 = this.perm[ ii + i2 + this.perm[ jj + j2 + this.perm[ kk + k2 ] ] ] % 12;\n\t\tconst gi3 = this.perm[ ii + 1 + this.perm[ jj + 1 + this.perm[ kk + 1 ] ] ] % 12;\n\t\t// Calculate the contribution from the four corners\n\t\tlet t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n\t\tif ( t0 < 0 ) n0 = 0.0;\n\t\telse {\n\n\t\t\tt0 *= t0;\n\t\t\tn0 = t0 * t0 * this.dot3( this.grad3[ gi0 ], x0, y0, z0 );\n\n\t\t}\n\n\t\tlet t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n\t\tif ( t1 < 0 ) n1 = 0.0;\n\t\telse {\n\n\t\t\tt1 *= t1;\n\t\t\tn1 = t1 * t1 * this.dot3( this.grad3[ gi1 ], x1, y1, z1 );\n\n\t\t}\n\n\t\tlet t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n\t\tif ( t2 < 0 ) n2 = 0.0;\n\t\telse {\n\n\t\t\tt2 *= t2;\n\t\t\tn2 = t2 * t2 * this.dot3( this.grad3[ gi2 ], x2, y2, z2 );\n\n\t\t}\n\n\t\tlet t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n\t\tif ( t3 < 0 ) n3 = 0.0;\n\t\telse {\n\n\t\t\tt3 *= t3;\n\t\t\tn3 = t3 * t3 * this.dot3( this.grad3[ gi3 ], x3, y3, z3 );\n\n\t\t}\n\n\t\t// Add contributions from each corner to get the final noise value.\n\t\t// The result is scaled to stay just inside [-1,1]\n\t\treturn 32.0 * ( n0 + n1 + n2 + n3 );\n\n\t}\n\n\t// 4D simplex noise\n\tnoise4d( x, y, z, w ) {\n\n\t\t// For faster and easier lookups\n\t\tconst grad4 = this.grad4;\n\t\tconst simplex = this.simplex;\n\t\tconst perm = this.perm;\n\n\t\t// The skewing and unskewing factors are hairy again for the 4D case\n\t\tconst F4 = ( Math.sqrt( 5.0 ) - 1.0 ) / 4.0;\n\t\tconst G4 = ( 5.0 - Math.sqrt( 5.0 ) ) / 20.0;\n\t\tlet n0; // Noise contributions from the five corners\n\t\tlet n1;\n\t\tlet n2;\n\t\tlet n3;\n\t\tlet n4;\n\t\t// Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n\t\tconst s = ( x + y + z + w ) * F4; // Factor for 4D skewing\n\t\tconst i = Math.floor( x + s );\n\t\tconst j = Math.floor( y + s );\n\t\tconst k = Math.floor( z + s );\n\t\tconst l = Math.floor( w + s );\n\t\tconst t = ( i + j + k + l ) * G4; // Factor for 4D unskewing\n\t\tconst X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\n\t\tconst Y0 = j - t;\n\t\tconst Z0 = k - t;\n\t\tconst W0 = l - t;\n\t\tconst x0 = x - X0; // The x,y,z,w distances from the cell origin\n\t\tconst y0 = y - Y0;\n\t\tconst z0 = z - Z0;\n\t\tconst w0 = w - W0;\n\n\t\t// For the 4D case, the simplex is a 4D shape I won't even try to describe.\n\t\t// To find out which of the 24 possible simplices we're in, we need to\n\t\t// determine the magnitude ordering of x0, y0, z0 and w0.\n\t\t// The method below is a good way of finding the ordering of x,y,z,w and\n\t\t// then find the correct traversal order for the simplex we’re in.\n\t\t// First, six pair-wise comparisons are performed between each possible pair\n\t\t// of the four coordinates, and the results are used to add up binary bits\n\t\t// for an integer index.\n\t\tconst c1 = ( x0 > y0 ) ? 32 : 0;\n\t\tconst c2 = ( x0 > z0 ) ? 16 : 0;\n\t\tconst c3 = ( y0 > z0 ) ? 8 : 0;\n\t\tconst c4 = ( x0 > w0 ) ? 4 : 0;\n\t\tconst c5 = ( y0 > w0 ) ? 2 : 0;\n\t\tconst c6 = ( z0 > w0 ) ? 1 : 0;\n\t\tconst c = c1 + c2 + c3 + c4 + c5 + c6;\n\n\t\t// simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\n\t\t// Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\n\t\t// impossible. Only the 24 indices which have non-zero entries make any sense.\n\t\t// We use a thresholding to set the coordinates in turn from the largest magnitude.\n\t\t// The number 3 in the \"simplex\" array is at the position of the largest coordinate.\n\t\tconst i1 = simplex[ c ][ 0 ] >= 3 ? 1 : 0;\n\t\tconst j1 = simplex[ c ][ 1 ] >= 3 ? 1 : 0;\n\t\tconst k1 = simplex[ c ][ 2 ] >= 3 ? 1 : 0;\n\t\tconst l1 = simplex[ c ][ 3 ] >= 3 ? 1 : 0;\n\t\t// The number 2 in the \"simplex\" array is at the second largest coordinate.\n\t\tconst i2 = simplex[ c ][ 0 ] >= 2 ? 1 : 0;\n\t\tconst j2 = simplex[ c ][ 1 ] >= 2 ? 1 : 0;\n\t\tconst k2 = simplex[ c ][ 2 ] >= 2 ? 1 : 0;\n\t\tconst l2 = simplex[ c ][ 3 ] >= 2 ? 1 : 0;\n\t\t// The number 1 in the \"simplex\" array is at the second smallest coordinate.\n\t\tconst i3 = simplex[ c ][ 0 ] >= 1 ? 1 : 0;\n\t\tconst j3 = simplex[ c ][ 1 ] >= 1 ? 1 : 0;\n\t\tconst k3 = simplex[ c ][ 2 ] >= 1 ? 1 : 0;\n\t\tconst l3 = simplex[ c ][ 3 ] >= 1 ? 1 : 0;\n\t\t// The fifth corner has all coordinate offsets = 1, so no need to look that up.\n\t\tconst x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\n\t\tconst y1 = y0 - j1 + G4;\n\t\tconst z1 = z0 - k1 + G4;\n\t\tconst w1 = w0 - l1 + G4;\n\t\tconst x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\n\t\tconst y2 = y0 - j2 + 2.0 * G4;\n\t\tconst z2 = z0 - k2 + 2.0 * G4;\n\t\tconst w2 = w0 - l2 + 2.0 * G4;\n\t\tconst x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\n\t\tconst y3 = y0 - j3 + 3.0 * G4;\n\t\tconst z3 = z0 - k3 + 3.0 * G4;\n\t\tconst w3 = w0 - l3 + 3.0 * G4;\n\t\tconst x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\n\t\tconst y4 = y0 - 1.0 + 4.0 * G4;\n\t\tconst z4 = z0 - 1.0 + 4.0 * G4;\n\t\tconst w4 = w0 - 1.0 + 4.0 * G4;\n\t\t// Work out the hashed gradient indices of the five simplex corners\n\t\tconst ii = i & 255;\n\t\tconst jj = j & 255;\n\t\tconst kk = k & 255;\n\t\tconst ll = l & 255;\n\t\tconst gi0 = perm[ ii + perm[ jj + perm[ kk + perm[ ll ] ] ] ] % 32;\n\t\tconst gi1 = perm[ ii + i1 + perm[ jj + j1 + perm[ kk + k1 + perm[ ll + l1 ] ] ] ] % 32;\n\t\tconst gi2 = perm[ ii + i2 + perm[ jj + j2 + perm[ kk + k2 + perm[ ll + l2 ] ] ] ] % 32;\n\t\tconst gi3 = perm[ ii + i3 + perm[ jj + j3 + perm[ kk + k3 + perm[ ll + l3 ] ] ] ] % 32;\n\t\tconst gi4 = perm[ ii + 1 + perm[ jj + 1 + perm[ kk + 1 + perm[ ll + 1 ] ] ] ] % 32;\n\t\t// Calculate the contribution from the five corners\n\t\tlet t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\n\t\tif ( t0 < 0 ) n0 = 0.0;\n\t\telse {\n\n\t\t\tt0 *= t0;\n\t\t\tn0 = t0 * t0 * this.dot4( grad4[ gi0 ], x0, y0, z0, w0 );\n\n\t\t}\n\n\t\tlet t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\n\t\tif ( t1 < 0 ) n1 = 0.0;\n\t\telse {\n\n\t\t\tt1 *= t1;\n\t\t\tn1 = t1 * t1 * this.dot4( grad4[ gi1 ], x1, y1, z1, w1 );\n\n\t\t}\n\n\t\tlet t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\n\t\tif ( t2 < 0 ) n2 = 0.0;\n\t\telse {\n\n\t\t\tt2 *= t2;\n\t\t\tn2 = t2 * t2 * this.dot4( grad4[ gi2 ], x2, y2, z2, w2 );\n\n\t\t}\n\n\t\tlet t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\n\t\tif ( t3 < 0 ) n3 = 0.0;\n\t\telse {\n\n\t\t\tt3 *= t3;\n\t\t\tn3 = t3 * t3 * this.dot4( grad4[ gi3 ], x3, y3, z3, w3 );\n\n\t\t}\n\n\t\tlet t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\n\t\tif ( t4 < 0 ) n4 = 0.0;\n\t\telse {\n\n\t\t\tt4 *= t4;\n\t\t\tn4 = t4 * t4 * this.dot4( grad4[ gi4 ], x4, y4, z4, w4 );\n\n\t\t}\n\n\t\t// Sum up and scale the result to cover the range [-1,1]\n\t\treturn 27.0 * ( n0 + n1 + n2 + n3 + n4 );\n\n\t}\n\n}\n\nexport { SimplexNoise };\n","/* global AFRAME, THREE */\n// This is a modified copy of https://github.com/mozilla/hubs/blob/b466e6901cb2a0310b5219e2dac41731d7fa0916/src/components/simple-water.js\n// and https://github.com/mozilla/hubs/blob/f099ec6cb9a15c8f7554ffdbec592f9abf6c7267/src/objects/SimpleWaterMesh.ts\n// and https://github.com/mozilla/hubs/blob/c734c4d8c09a4969ea7793de9e500f3b39cc9a8e/src/assets/waternormals.jpg\n// Changes required was removing typescript annotations, removing APP.store.state.preferences.materialQualitySetting usage and replacing HubsTextureLoader by TextureLoader.\n// @license MPL 2.0 https://github.com/mozilla/hubs/blob/master/LICENSE\n\nimport {\n  Mesh,\n  PlaneGeometry,\n  MeshStandardMaterial,\n  MeshPhongMaterial,\n  Vector2,\n  RepeatWrapping,\n  TextureLoader,\n} from \"three\";\nimport { SimplexNoise } from \"three/addons/math/SimplexNoise.js\";\nimport waterNormalsUrl from \"../assets/waternormals.jpg\";\n\n/**\n * SimpleWater\n */\n\n/**\n * Adapted dynamic geometry code from: https://github.com/ditzel/UnityOceanWavesAndShip\n */\n\nclass Octave {\n  constructor(speed = new Vector2(1, 1), scale = new Vector2(1, 1), height = 0.0025, alternate = true) {\n    this.speed = speed;\n    this.scale = scale;\n    this.height = height;\n    this.alternate = alternate;\n  }\n}\nexport default class SimpleWater extends Mesh {\n  constructor(normalMap, resolution = 24, lowQuality = false) {\n    const geometry = new PlaneGeometry(10, 10, resolution, resolution);\n    geometry.rotateX(-Math.PI / 2);\n\n    const waterUniforms = {\n      ripplesSpeed: { value: 0.25 },\n      ripplesScale: { value: 1 },\n      time: { value: 0 },\n    };\n\n    const MaterialClass = lowQuality ? MeshPhongMaterial : MeshStandardMaterial;\n\n    normalMap.wrapS = normalMap.wrapT = RepeatWrapping;\n\n    const material = new MaterialClass({ color: 0x0054df, normalMap, roughness: 0.5, metalness: 0.5 });\n    material.name = \"SimpleWaterMaterial\";\n\n    material.onBeforeCompile = (shader) => {\n      Object.assign(shader.uniforms, waterUniforms);\n\n      shader.vertexShader = shader.vertexShader.replace(\n        \"#include <fog_pars_vertex>\",\n        `\n        #include <fog_pars_vertex>\n        varying vec3 vWPosition;\n      `\n      );\n\n      shader.vertexShader = shader.vertexShader.replace(\n        \"#include <fog_vertex>\",\n        `\n        #include <fog_vertex>\n        vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;\n      `\n      );\n\n      // getNoise function from https://github.com/mrdoob/three.js/blob/dev/examples/jsm/objects/Water.js\n      shader.fragmentShader = shader.fragmentShader.replace(\n        \"#include <normalmap_pars_fragment>\",\n        `\n        #include <normalmap_pars_fragment>\n\n        uniform float time;\n        uniform float ripplesSpeed;\n        uniform float ripplesScale;\n      \n        varying vec3 vWPosition;\n      \n        vec4 getNoise(vec2 uv){\n          float timeOffset = time * ripplesSpeed;\n          uv = (uv - 0.5) * (1.0 / ripplesScale);\n          vec2 uv0 = (uv/103.0)+vec2(timeOffset/17.0, timeOffset/29.0);\n          vec2 uv1 = uv/107.0-vec2(timeOffset/-19.0, timeOffset/31.0);\n          vec2 uv2 = uv/vec2(897.0, 983.0)+vec2(timeOffset/101.0, timeOffset/97.0);\n          vec2 uv3 = uv/vec2(991.0, 877.0)-vec2(timeOffset/109.0, timeOffset/-113.0);\n          vec4 noise = (texture2D(normalMap, uv0)) +\n                       (texture2D(normalMap, uv1)) +\n                       (texture2D(normalMap, uv2)) +\n                       (texture2D(normalMap, uv3));\n          return noise / 4.0;\n        }\n      `\n      );\n\n      // https://github.com/mrdoob/three.js/blob/dev/src/renderers/shaders/ShaderChunk/normalmap_pars_fragment.glsl.js#L20\n      shader.fragmentShader = shader.fragmentShader.replace(\n        \"#include <normal_fragment_maps>\",\n        `\n          // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n          vec3 eye_pos = -vViewPosition;\n          vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n          vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n          vec2 st0 = dFdx( vUv.st );\n          vec2 st1 = dFdy( vUv.st );\n\n          float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude\n\n          vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n          vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n          vec3 N = normalize( normal );\n          mat3 tsn = mat3( S, T, N );\n\n          vec3 mapN = getNoise(vWPosition.xz).xyz * 2.0 - 1.0;\n\n          mapN.xy *= normalScale;\n          mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n          normal = normalize( tsn * mapN );\n        `\n      );\n    };\n\n    super(geometry, material);\n\n    this.lowQuality = lowQuality;\n    this.waterUniforms = waterUniforms;\n\n    if (lowQuality) {\n      this.material.specular.set(0xffffff);\n    } else {\n      this.receiveShadow = true;\n    }\n\n    this.geometry.attributes.position.dynamic = true;\n\n    this.resolution = resolution;\n    this.octaves = [\n      new Octave(new Vector2(0.5, 0.5), new Vector2(1, 1), 0.01, true),\n      new Octave(new Vector2(0.05, 6), new Vector2(1, 20), 0.1, false),\n    ];\n\n    this.simplex = new SimplexNoise();\n  }\n\n  get opacity() {\n    return this.material.opacity;\n  }\n\n  set opacity(value) {\n    this.material.opacity = value;\n    this.material.transparent = value !== 1;\n  }\n\n  get color() {\n    return this.material.color;\n  }\n\n  get tideHeight() {\n    return this.octaves[0].height;\n  }\n\n  set tideHeight(value) {\n    this.octaves[0].height = value;\n  }\n\n  get tideScale() {\n    return this.octaves[0].scale;\n  }\n\n  get tideSpeed() {\n    return this.octaves[0].speed;\n  }\n\n  get waveHeight() {\n    return this.octaves[1].height;\n  }\n\n  set waveHeight(value) {\n    this.octaves[1].height = value;\n  }\n\n  get waveScale() {\n    return this.octaves[1].scale;\n  }\n\n  get waveSpeed() {\n    return this.octaves[1].speed;\n  }\n\n  set ripplesSpeed(value) {\n    this.waterUniforms.ripplesSpeed.value = value;\n  }\n\n  get ripplesSpeed() {\n    return this.waterUniforms.ripplesSpeed.value;\n  }\n\n  set ripplesScale(value) {\n    this.waterUniforms.ripplesScale.value = value;\n  }\n\n  get ripplesScale() {\n    return this.waterUniforms.ripplesScale.value;\n  }\n\n  update(time) {\n    const positionAttribute = this.geometry.attributes.position;\n\n    for (let x = 0; x <= this.resolution; x++) {\n      for (let z = 0; z <= this.resolution; z++) {\n        let y = 0;\n\n        for (let o = 0; o < this.octaves.length; o++) {\n          const octave = this.octaves[o];\n\n          if (octave.alternate) {\n            const noise = this.simplex.noise(\n              (x * octave.scale.x) / this.resolution,\n              (z * octave.scale.y) / this.resolution\n            );\n            y += Math.cos(noise + octave.speed.length() * time) * octave.height;\n          } else {\n            const noise =\n              this.simplex.noise(\n                (x * octave.scale.x + time * octave.speed.x) / this.resolution,\n                (z * octave.scale.y + time * octave.speed.y) / this.resolution\n              ) - 0.5;\n            y += noise * octave.height;\n          }\n        }\n\n        positionAttribute.setY(x * (this.resolution + 1) + z, y);\n      }\n    }\n\n    this.geometry.computeVertexNormals();\n    positionAttribute.needsUpdate = true;\n    this.waterUniforms.time.value = time;\n  }\n\n  clone(recursive) {\n    return new SimpleWater(this.material.normalMap, this.resolution, this.lowQuality).copy(this, recursive);\n  }\n\n  copy(source, recursive = true) {\n    super.copy(source, recursive);\n\n    this.opacity = source.opacity;\n    this.color.copy(source.color);\n    this.tideHeight = source.tideHeight;\n    this.tideScale.copy(source.tideScale);\n    this.tideSpeed.copy(source.tideSpeed);\n    this.waveHeight = source.waveHeight;\n    this.waveScale.copy(source.waveScale);\n    this.waveSpeed.copy(source.waveSpeed);\n    this.ripplesSpeed = source.ripplesSpeed;\n    this.ripplesScale = source.ripplesScale;\n\n    return this;\n  }\n}\n\nfunction vec2Equals(a, b) {\n  return a && b && a.x === b.x && a.y === b.y;\n}\n\nlet waterNormalMap = null;\n\nAFRAME.registerComponent(\"simple-water\", {\n  schema: {\n    opacity: { type: \"number\", default: 1 },\n    color: { type: \"color\" },\n    tideHeight: { type: \"number\", default: 0.01 },\n    tideScale: { type: \"vec2\", default: { x: 1, y: 1 } },\n    tideSpeed: { type: \"vec2\", default: { x: 0.5, y: 0.5 } },\n    waveHeight: { type: \"number\", default: 0.1 },\n    waveScale: { type: \"vec2\", default: { x: 1, y: 20 } },\n    waveSpeed: { type: \"vec2\", default: { x: 0.05, y: 6 } },\n    ripplesScale: { type: \"number\", default: 1 },\n    ripplesSpeed: { type: \"number\", default: 0.25 },\n  },\n\n  init() {\n    if (!waterNormalMap) {\n      waterNormalMap = new TextureLoader().load(waterNormalsUrl);\n    }\n\n    const usePhongShader = false; // window.APP.store.state.preferences.materialQualitySetting !== \"high\";\n    this.water = new SimpleWater(waterNormalMap, undefined, usePhongShader);\n    this.el.setObject3D(\"mesh\", this.water);\n  },\n\n  update(oldData) {\n    if (this.data.opacity !== oldData.opacity) {\n      this.water.opacity = this.data.opacity;\n    }\n\n    if (this.data.color !== oldData.color) {\n      this.water.color.set(this.data.color);\n    }\n\n    if (this.data.tideHeight !== oldData.tideHeight) {\n      this.water.tideHeight = this.data.tideHeight;\n    }\n\n    if (!vec2Equals(this.data.tideScale, oldData.tideScale)) {\n      this.water.tideScale.copy(this.data.tideScale);\n    }\n\n    if (!vec2Equals(this.data.tideSpeed, oldData.tideSpeed)) {\n      this.water.tideSpeed.copy(this.data.tideSpeed);\n    }\n\n    if (this.data.waveHeight !== oldData.waveHeight) {\n      this.water.waveHeight = this.data.waveHeight;\n    }\n\n    if (!vec2Equals(this.data.waveScale, oldData.waveScale)) {\n      this.water.waveScale.copy(this.data.waveScale);\n    }\n\n    if (!vec2Equals(this.data.waveSpeed, oldData.waveSpeed)) {\n      this.water.waveSpeed.copy(this.data.waveSpeed);\n    }\n\n    if (this.data.ripplesScale !== oldData.ripplesScale) {\n      this.water.ripplesScale = this.data.ripplesScale;\n    }\n\n    if (this.data.ripplesSpeed !== oldData.ripplesSpeed) {\n      this.water.ripplesSpeed = this.data.ripplesSpeed;\n    }\n  },\n\n  tick(time) {\n    this.water.update(time / 1000);\n  },\n\n  remove() {\n    const mesh = this.el.getObject3D(\"mesh\");\n    mesh.geometry.dispose();\n    // mesh.material.normalMap.dispose(); // the texture may be used by another component\n    mesh.material.dispose();\n    this.el.removeObject3D(\"mesh\");\n  },\n});\n","/* global AFRAME, THREE, NAF */\n\nexport const teleportTo = (position, rotation, withTransition = true) => {\n  const quaternion = new THREE.Quaternion();\n  quaternion.setFromEuler(new THREE.Euler(0, THREE.MathUtils.degToRad(rotation.y), 0));\n  const cameraRig = document.querySelector(\"#rig,#cameraRig\");\n  const camera = cameraRig.querySelector(\"[camera]\");\n  const cursorTeleport = cameraRig?.components[\"cursor-teleport\"];\n  withTransition = withTransition && !cameraRig.sceneEl.is(\"vr-mode\");\n  if (withTransition && cursorTeleport) {\n    cursorTeleport.teleportTo(position, quaternion);\n  } else {\n    if (cameraRig.hasAttribute(\"simple-navmesh-constraint\")) {\n      cameraRig.setAttribute(\"simple-navmesh-constraint\", \"enabled\", false);\n    }\n    const camForRotation = camera.object3D;\n    const destQuaternion = new THREE.Quaternion();\n    destQuaternion.setFromEuler(new THREE.Euler(0, camForRotation.rotation.y, 0));\n    destQuaternion.invert();\n    destQuaternion.multiply(quaternion);\n    cameraRig.object3D.position.copy(position);\n    cameraRig.object3D.quaternion.copy(destQuaternion);\n    if (cameraRig.hasAttribute(\"simple-navmesh-constraint\")) {\n      cameraRig.setAttribute(\"simple-navmesh-constraint\", \"enabled\", true);\n    }\n  }\n\n  if (camera) {\n    camera.components[\"look-controls\"].pitchObject.rotation.x = THREE.MathUtils.DEG2RAD * rotation.x;\n  }\n};\n\nexport const waypointSchema = {\n  template: \"#waypoint-template\",\n  components: [\n    {\n      component: \"waypoint\",\n      property: \"isOccupied\",\n    },\n    {\n      component: \"waypoint\",\n      property: \"occupiedBy\",\n    },\n  ],\n};\n\nfunction genClientId() {\n  return String(crypto.getRandomValues(new Uint32Array(1))[0]);\n}\n\nconst clientId = genClientId();\n\nfunction getClientId() {\n  // this.el.setAttribute(\"waypoint\", { isOccupied: true, occupiedBy: NAF.clientId });\n  // with NAF.clientId empty string didn't set empty string but kept \"scene\", we use here clientId that is not empty even if not connected\n  // so the unoccupyWaypoints function works correctly when not connected.\n  return NAF.clientId || clientId;\n}\n\nexport const registeredWaypoints = [];\n\nexport const unoccupyWaypoints = () => {\n  registeredWaypoints.forEach((waypoint) => {\n    if (waypoint.components.networked && waypoint.components.waypoint.data.occupiedBy === getClientId()) {\n      waypoint.setAttribute(\"waypoint\", { isOccupied: false, occupiedBy: \"scene\" });\n      // In case of reconnect, someone else may have the actual ownership\n      // of my seat, so be sure to take ownership.\n      if (NAF.connection.adapter) NAF.utils.takeOwnership(waypoint);\n    }\n  });\n\n  const cameraRig = document.querySelector(\"#rig,#cameraRig\");\n  cameraRig.components[\"player-info\"].occupyWaypoint = false;\n  cameraRig.setAttribute(\"player-info\", \"avatarPose\", \"stand\");\n};\n\nAFRAME.registerComponent(\"waypoint\", {\n  schema: {\n    canBeClicked: { type: \"bool\", default: false },\n    canBeOccupied: { type: \"bool\", default: false },\n    canBeSpawnPoint: { type: \"bool\", default: false },\n    snapToNavMesh: { type: \"bool\", default: false },\n    willDisableMotion: { type: \"bool\", default: false },\n    willDisableTeleporting: { type: \"bool\", default: false },\n    willMaintainInitialOrientation: { type: \"bool\", default: false },\n    isOccupied: { type: \"bool\", default: false },\n    occupiedBy: { type: \"string\", default: \"scene\" },\n  },\n  events: {\n    \"model-loaded\": function (evt) {\n      this.registerWaypoint();\n      this.el.classList.add(\"clickable\");\n      let rootNode = this.el.object3D.getObjectByName(\"RootNode\");\n      if (!rootNode.material && rootNode.children.length > 0) {\n        rootNode = rootNode.children[0];\n      }\n      if (rootNode && rootNode.material) {\n        this.mesh = rootNode;\n        if (!this.originalColor) {\n          this.originalColor = this.mesh.material.color.clone();\n        }\n        this.mesh.material.visible = false;\n      }\n    },\n    mouseenter: function (evt) {\n      if (this.mesh && !this.data.isOccupied) {\n        this.mesh.material.color.set(\"#0284c7\");\n        this.mesh.material.visible = true;\n      }\n    },\n    mouseleave: function (evt) {\n      if (this.mesh) {\n        this.mesh.material.color.set(this.originalColor);\n        this.mesh.material.visible = false;\n      }\n    },\n    \"ownership-gained\": function (evt) {\n      // We can gain the ownership automatically when previous owner of the\n      // persistent entity disconnect. Every participant gains the ownership, so\n      // there is a race condition to set isOccupied:false here.\n      if (\n        !this.el.sceneEl.is(\"naf:reconnecting\") &&\n        this.data.isOccupied &&\n        NAF.connection.activeDataChannels[this.data.occupiedBy] === false\n      ) {\n        setTimeout(() => {\n          if (NAF.utils.isMine(this.el)) {\n            // reconnected user may have taken back ownership after the 2s so do nothing in this case\n            this.el.setAttribute(\"waypoint\", { isOccupied: false });\n            // don't set occupiedBy:scene, the disconnected user will have a chance to occupy it again\n          }\n        }, 2000);\n      }\n    },\n    click: function (evt) {\n      unoccupyWaypoints();\n      const cameraRig = document.querySelector(\"#rig,#cameraRig\");\n      const camera = cameraRig.querySelector(\"[camera]\");\n\n      cameraRig.components[\"player-info\"].occupyWaypoint = true;\n      // Note: there is a check for occupyWaypoint in the movement-controls component\n      if (this.el.components.networked) {\n        this.el.setAttribute(\"waypoint\", { isOccupied: true, occupiedBy: getClientId() });\n        if (NAF.connection.adapter) NAF.utils.takeOwnership(this.el);\n      }\n\n      const spawnPoint = this.el;\n      const avatarPose = this.data.canBeOccupied && this.data.willDisableMotion ? \"sit\" : \"stand\";\n      cameraRig.setAttribute(\"player-info\", \"avatarPose\", avatarPose);\n\n      const position = new THREE.Vector3();\n      position.copy(spawnPoint.object3D.position);\n      const playerInfo = cameraRig.components[\"player-info\"];\n      const avatarSitOffset = playerInfo.avatarSitOffset ?? 0.45;\n      if (playerInfo.data.avatarPose === \"sit\") {\n        position.y -= avatarSitOffset;\n      }\n\n      const euler = new THREE.Euler().setFromQuaternion(spawnPoint.object3D.quaternion, \"YXZ\");\n      const rotation = { x: 0, y: euler.y * THREE.MathUtils.RAD2DEG + 180, z: 0 };\n      teleportTo(position, rotation, false);\n      cameraRig.setAttribute(\"player-info\", { seatRotation: camera.object3D.rotation.y });\n    },\n  },\n  registerWaypoint() {\n    // be sure to not add it twice\n    const idx = registeredWaypoints.indexOf(this.el);\n    if (idx === -1) {\n      registeredWaypoints.push(this.el);\n    }\n  },\n  unregisterWaypoint() {\n    // it may already be removed, so be careful indexOf is not -1 otherwise it will remove the last item of the array\n    const idx = registeredWaypoints.indexOf(this.el);\n    if (idx > -1) {\n      registeredWaypoints.splice(idx, 1);\n    }\n  },\n  init() {\n    if (!this.data.canBeClicked) {\n      this.registerWaypoint();\n      // so we have it in the registeredWaypoints array, and it won't be raycastable because we don't have a mesh\n    }\n    // if canBeClicked, then we added a gltf-model component and it will be registered in model-loaded\n  },\n  remove() {\n    this.unregisterWaypoint();\n  },\n  update(oldData) {\n    // this.data.isOccupied is false if some other participant set it to\n    // false in ownership-gained and sent me back the change when I'm reconnected\n    if (!this.data.isOccupied && this.data.occupiedBy === getClientId()) {\n      // take back my seat if I didn't choose another seat while I was reconnecting\n      const currentlyOnAnotherSeat = registeredWaypoints.find((waypoint) => {\n        return (\n          this.el !== waypoint &&\n          waypoint.components.networked &&\n          waypoint.components.waypoint.data.occupiedBy === getClientId()\n        );\n      });\n      if (currentlyOnAnotherSeat) {\n        this.el.setAttribute(\"waypoint\", { isOccupied: false, occupiedBy: \"scene\" });\n      } else {\n        this.el.setAttribute(\"waypoint\", { isOccupied: true });\n      }\n      if (NAF.connection.adapter) NAF.utils.takeOwnership(this.el);\n    }\n\n    if (this.data.canBeClicked && oldData.isOccupied !== this.data.isOccupied) {\n      if (this.data.isOccupied) {\n        this.el.object3D.visible = false;\n        this.el.classList.remove(\"clickable\");\n      } else {\n        this.el.object3D.visible = true;\n        this.el.classList.add(\"clickable\");\n      }\n    }\n  },\n});\n","// Calculate the base URL based on the script's src attribute\nconst baseUrl = new URL(document.currentScript.src).href.replace(/gltf-model-plus.min.js$/, \"\");\n// Set the webpack public path to load assets from the correct location\n__webpack_public_path__ = `${baseUrl}dist/`;\n\nimport \"./components/environment-settings\";\nimport \"./components/gltf-model-plus\";\nimport \"./components/media-frame\";\nimport \"./components/reflection-probe\";\nimport \"./components/simple-water\";\nimport \"./components/uv-scroll\";\nimport \"./components/waypoint\";\nimport \"./inflators\";\n"],"names":["root","factory","exports","module","require","define","amd","a","i","self","__WEBPACK_EXTERNAL_MODULE__612__","AFRAME","registerComponent","schema","size","default","envMapTexture","type","init","this","el","object3D","updateWorldMatrix","box","THREE","Box3","setFromCenterAndSize","Vector3","setScalar","data","applyMatrix4","matrixWorld","setObject3D","ReflectionProbe","textureToData","Map","registeredTextures","registerSystem","tick","t","dt","length","map","offset","instances","get","component","addScaledVector","speed","x","y","increment","play","mesh","getObject3D","material","instance","emissiveMap","has","set","Vector2","push","console","warn","components","addEventListener","pause","splice","indexOf","delete","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","r","Symbol","toStringTag","Object","defineProperty","value","p","RGBELoader","DataTextureLoader","constructor","manager","super","HalfFloatType","parse","buffer","rgbe_error","rgbe_error_code","msg","Error","fgets","lineLimit","consume","pos","len","s","chunk","String","fromCharCode","apply","Uint16Array","subarray","byteLength","slice","RGBEByteToRGBFloat","sourceArray","sourceOffset","destArray","destOffset","e","scale","Math","pow","RGBEByteToRGBHalf","DataUtils","toHalfFloat","min","byteArray","Uint8Array","rgbe_header_info","gamma_re","exposure_re","format_re","dimensions_re","header","valid","string","comments","programtype","format","gamma","exposure","width","height","line","match","charAt","parseFloat","parseInt","RGBE_ReadHeader","w","h","image_rgba_data","scanline_width","data_rgba","ptr_end","rgbeStart","scanline_buffer","num_scanlines","count","ptr","isEncodedRun","byteValue","l","off","RGBE_ReadPixels_RLE","numElements","FloatType","floatArray","Float32Array","j","halfArray","setDataType","load","url","onLoad","onProgress","onError","texture","texData","colorSpace","LinearSRGBColorSpace","minFilter","LinearFilter","magFilter","generateMipmaps","flipY","LUTCubeLoader","Loader","UnsignedByteType","setType","loader","FileLoader","setPath","path","setResponseType","text","error","itemError","input","regExpDataPoints","result","exec","title","Number","domainMin","domainMax","z","DataTexture","image","wrapS","ClampToEdgeWrapping","wrapT","needsUpdate","texture3D","Data3DTexture","depth","wrapR","defaultEnvironmentSettings","toneMapping","toneMappingExposure","backgroundColor","backgroundTexture","blenderLUTPromise","updateMaterials","scene","traverse","o","EventDispatcher","listener","_listeners","listeners","hasEventListener","removeEventListener","listenerArray","index","dispatchEvent","event","array","call","eventData","singlePropUpdate","FAKE_NODE","removeChild","FakeEntity","node","initializingComponents","sceneEl","isEntity","isPlaying","object3DMap","rotationObj","states","parentElement","parentNode","hasLoaded","mixinEls","tagName","isFakeEntity","children","addState","state","is","emit","removeState","stateIndex","getAttribute","attr","position","entityEl","radToDeg","MathUtils","rotation","getRotation","visible","getDOMAttribute","flushToDOM","removeAttribute","setAttribute","componentName","arg1","arg2","id","newAttrValue","clobber","utils","styleParser","key","updateComponent","attrValue","removeComponent","updateProperties","initComponent","attrName","isDependency","addComponent","name","destroy","initialized","remove","evtDetail","tryRemoveLater","evt","detail","obj","oldObj","child","add","object","removeObject3D","bubbles","extraData","extend","target","CustomEvent","fakeEl","Component","createEntityAndReparent","klass","entity","document","createElement","classList","appendChild","removeFromParent","attach","gltfInflators","settings","renderer","materialsNeedUpdate","newToneMapping","LUTToneMapping","Promise","resolve","reject","then","tonemappingLUT","catch","mapping","EquirectangularReflectionMapping","background","Color","environment","componentProps","otherComponents","template","attachTemplateToLocal","networkId","networked","persistent","owner","NAF","connection","adapter","body","cameraRig","querySelector","canBeOccupied","canBeClicked","willDisableMotion","HDR_FILE_RE","absoluteURLForAsset","window","asset","oneOf","backgroundTextureUrl","isHDR","test","TextureLoader","setWithCredentials","NearestMipmapNearestFilter","NearestMipmapLinearFilter","NearestFilter","LinearMipmapNearestFilter","LinearMipmapLinearFilter","encoding","sRGBEncoding","envMapTextureUrl","GLTFMozTextureRGBE","parser","loadTexture","textureIndex","textureDef","json","textures","extensions","source","loadTextureImage","GLTFHubsComponentsExtension","afterRoot","scenes","deps","resolveComponents","gltfRootType","idx","associations","ext","userData","gltfExtensions","assign","MOZ_hubs_components","props","propName","__mhc_link_type","getDependency","loadedDep","MOZ_texture_rgbe","fn","bind","Array","isArray","all","GLTFHubsLightMapExtension","loadMaterial","materialIndex","materialDef","materials","extensionDef","pending","results","lightMap","lightMapIntensity","intensity","isMeshBasicMaterial","PI","disposeTextures","propertyName","Texture","ImageBitmap","close","dispose","disposeNode","Mesh","geometry","m","gltfModelPlus","dracoLoader","systems","getDRACOLoader","meshoptDecoder","getMeshoptDecoder","ktxLoader","getKTX2Loader","model","removers","GLTFLoader","mixer","register","setDRACOLoader","ready","setMeshoptDecoder","setKTX2Loader","update","src","gltfModel","animations","finalizers","environmentSettings","isMesh","reflectionProbeMode","hubsComponents","log","entries","forEach","AnimationMixer","isNaN","addBehavior","activeClipIndices","clips","clipName","clip","clipNames","split","n","find","action","clipAction","enabled","setLoop","LoopRepeat","Infinity","inflator","contains","setTimeout","shadowMap","originalEvent","message","stopAllAction","removeBehavior","registeredMediaframes","mediaFramesById","getClosestMediaFrame","filterByMediaType","mediaFrames","filter","mediaFrame","mediaType","cameraRigPosition","sort","b","distanceTo","getElementById","getMediaFrameById","bounds","snapToCenter","SimplexNoise","grad3","grad4","floor","random","perm","simplex","dot","g","dot3","dot4","noise","xin","yin","n0","n1","n2","sqrt","G2","x0","y0","i1","j1","x1","y1","x2","y2","ii","jj","gi0","gi1","gi2","t0","t1","t2","noise3d","zin","n3","k","G3","z0","k1","i2","j2","k2","z1","z2","x3","y3","z3","kk","gi3","t3","noise4d","F4","G4","n4","w0","c","l1","l2","i3","j3","k3","l3","w1","w2","w3","x4","y4","z4","w4","ll","gi4","t4","Octave","alternate","SimpleWater","normalMap","resolution","lowQuality","PlaneGeometry","rotateX","waterUniforms","ripplesSpeed","ripplesScale","time","MaterialClass","MeshPhongMaterial","MeshStandardMaterial","RepeatWrapping","color","roughness","metalness","onBeforeCompile","shader","uniforms","vertexShader","replace","fragmentShader","specular","receiveShadow","attributes","dynamic","octaves","opacity","transparent","tideHeight","tideScale","tideSpeed","waveHeight","waveScale","waveSpeed","positionAttribute","octave","cos","setY","computeVertexNormals","clone","recursive","copy","vec2Equals","waterNormalMap","water","oldData","clientId","crypto","getRandomValues","Uint32Array","getClientId","registeredWaypoints","canBeSpawnPoint","snapToNavMesh","willDisableTeleporting","willMaintainInitialOrientation","isOccupied","occupiedBy","events","registerWaypoint","rootNode","getObjectByName","originalColor","mouseenter","mouseleave","activeDataChannels","isMine","click","waypoint","takeOwnership","occupyWaypoint","unoccupyWaypoints","camera","spawnPoint","avatarPose","playerInfo","avatarSitOffset","withTransition","quaternion","Quaternion","setFromEuler","Euler","degToRad","cursorTeleport","teleportTo","hasAttribute","camForRotation","destQuaternion","invert","multiply","pitchObject","DEG2RAD","setFromQuaternion","RAD2DEG","seatRotation","unregisterWaypoint","baseUrl","URL","currentScript","href"],"sourceRoot":""}